%\documentclass[handout, 11pt, xcolor=dvipsnames]{beamer} % ohne Animationen
\documentclass[11pt, xcolor=dvipsnames]{beamer} % mit Animationen
\usepackage[latin1]{inputenc}
\usepackage[ngerman]{babel}
\usepackage{amsmath}
\usepackage{dsfont}
\usepackage{lmodern} %für mathmode wichtig
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usetheme{Madrid}
\usepackage{textpos}
% Abbildungen
\usepackage{tikz}
\usetikzlibrary{arrows,shapes,positioning,shadows,trees}
\usepackage{braids}
%\usepackage[utf8]{inputenc}
\usepackage{smartdiagram}
\usesmartdiagramlibrary{additions}

\usepackage{listings}
\lstset{basicstyle=\ttfamily, breakatwhitespace=true, breaklines=true}

\usepackage[section,boxed]{algorithm}
\usepackage{algpseudocode}

\usepackage{caption}
\usepackage{subfig}
\usepackage{color}
\usepackage{url}                                            % %url{}-Kommando
\usepackage{fancyhdr,float}                                 % %Kopf-/Fußzeilen
\usepackage[round,square,comma,numbers]{natbib}                                  % %Zitate
%\usepackage{enumitem}
\usepackage{setspace}
\usepackage[export]{adjustbox} %Rahmen um Bilder
%Für Präsentationsmodus
\usepackage{hyperref}
%\hypersetup{pdfpagemode=FullScreen}

\usepackage{multirow}
\usepackage{colortbl}

\definecolor{tugreen}{HTML}{7CFF00}
\definecolor{darkgreen}{HTML}{037501}
\definecolor{lila}{HTML}{C984FE}
\definecolor{light-gray}{gray}{0.93}
%
%\setbeamercolor{block title}{use=structure,fg=black,bg=LimeGreen!50!white}
\setbeamercolor{block body}{use=structure,fg=black,bg=tugreen!10!white}
\setbeamercolor{frametitle}{use=structure,fg=black,bg=tugreen!40!white}

%Farbe des Beamer-Themes ändern
\usecolortheme[named=LimeGreen]{structure}
\makeatletter
\setbeamercolor{frametitle}{fg=black}
\setbeamercolor{title}{fg=black}
\setbeamercolor{palette primary}{fg=black,bg=tugreen!20!white} 
\setbeamercolor{palette secondary}{fg=black,bg=tugreen!40!white}
\setbeamercolor{palette tertiary}{fg=black,bg=LimeGreen}
\makeatother

\newenvironment<>{varblock}[2][.9\textwidth]{%
	\setlength{\textwidth}{#1}
	\begin{actionenv}#3%
		\def\insertblocktitle{#2}%
		\par%
		\usebeamertemplate{block begin}}
	{\par%
		\usebeamertemplate{block end}%
	\end{actionenv}}

%Beschriftung der Fußleiste der Folien anpassen - Section und Subsectiontitel müssen vor jeder Folie (vor \begin{frame}) eingefügt werden
\makeatletter
\setbeamertemplate{footline}
{
	\leavevmode%
	\hbox{%
		\begin{beamercolorbox}[wd=.333333\paperwidth,ht=4.25ex,dp=1ex,center]{author in head/foot}%
			\vfill
			\vspace{0.9ex}
			\usebeamerfont{author in head/foot}\insertsection
		\end{beamercolorbox}%
		\begin{beamercolorbox}[wd=.333333\paperwidth,ht=3.25ex,dp=1ex,center]{title in head/foot}%
			\vfill
			\vspace{0.4ex}
			\usebeamerfont{title in head/foot}\insertsubsection
		\end{beamercolorbox}%
		\begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,right]{date in head/foot}%
			\vfill
			\usebeamerfont{date in head/foot}Analyse von RAD-Seq-Daten\hspace*{2em}
			\insertframenumber{} / \inserttotalframenumber\hspace*{2ex} 
		\end{beamercolorbox}}%
	\vskip0pt%
}
\makeatother

% ++++++++++++++++++++++
% + Python listenings  +
% ++++++++++++++++++++++

% Default fixed font does not support bold face
\DeclareFixedFont{\ttb}{T1}{txtt}{bx}{n}{12} % for bold
\DeclareFixedFont{\ttm}{T1}{txtt}{m}{n}{12}  % for normal

% Custom colors
\usepackage{color}
\definecolor{deepblue}{rgb}{0,0,0.5}
\definecolor{deepred}{rgb}{0.6,0,0}
\definecolor{deepgreen}{rgb}{0,0.5,0}

% Python style for highlighting
\newcommand\pythonstyle{\lstset{
		language=Python,
		basicstyle=\ttm,
		morekeywords={self},              % Add keywords here
		keywordstyle=\ttb\color{deepblue},
		emph={MyClass,__init__},          % Custom highlighting
		emphstyle=\ttb\color{deepred},    % Custom highlighting style
		stringstyle=\color{deepgreen},
		frame=tb,                         % Any extra options here
		showstringspaces=false
}}


% Python environment
\lstnewenvironment{python}[1][]
{
	\pythonstyle
	\lstset{#1}
}
{}

% Python for external files
\newcommand\pythonexternal[2][]{{
		\pythonstyle
		\lstinputlisting[#1]{#2}}}

% Python for inline
\newcommand\pythoninline[1]{{\pythonstyle\lstinline!#1!}}


% +++++++++++++++++++++++++++++
% + Tikz properties for pics  +
% +++++++++++++++++++++++++++++
%https://texample.net/tikz/examples/labs-schema/
\usetikzlibrary{shadows,arrows}
% Layer des Diagramms
\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}

% Eigenschaften der Blöcke 
\tikzstyle{blocktxt}=[draw, text width=6.0em, text centered,
minimum height=1.5em,drop shadow]
\tikzstyle{blockitem} = [blocktxt, fill=green!40, text width=8em, minimum width=10em,
minimum height=3em, rounded corners, drop shadow]
\tikzstyle{ioitem} = [blocktxt, fill=white, text width=8em, minimum width=10em,
minimum height=3em, rounded corners, drop shadow]
\tikzstyle{sectiontxt} = [above, text = black, text width=6em, text centered]
\tikzstyle{dashedline} = [draw, thick, color=black, -latex', dashed]
\tikzstyle{line} = [draw, thick, color=red, -latex']
\tikzstyle{ur}=[draw, text centered, minimum height=0.01em]

% Distanzen
\newcommand{\blockdist}{1.3}
\newcommand{\edgedist}{1.5}

\newcommand{\blockitem}[2]{node (p#1) [blockitem]
	{\textbf{\textit{#2}}}}

\newcommand{\ioitem}[2]{node (p#1) [ioitem]
	{\textbf{\textit{#2}}}}

% Eigenschaften der DNA-Abbildung
\newcommand{\bond}[3]{
	\draw[very thick, #1] (#3, 0) -- (#3, 0.35);
	\draw[very thick, densely dotted] (#3, 0.35) -- (#3, 0.65);
	\draw[very thick, #2] (#3, 0.65) -- (#3, 1);
}
% Hintergrundfeld
\newcommand{\background}[5]{%
	\begin{pgfonlayer}{background}
		% Hintergrundfeld obere linke Ecke
		\path (#1.west |- #2.north)+(-3.3,0.3) node (a1) {};
		% Hintergrundfeld untere rechte Ecke
		\path (#3.east |- #4.south)+(+0.5,-0.25) node (a2) {};
		% Hintergrundeigenschaften
		\path[fill=blue!20,rounded corners, draw=black]
		(a1) rectangle (a2);
		\path (a1.east |- a1.south) +(-3.0,-1.0) node (u1)[sectiontxt]
		{\textbf{\textit{#5}}};
\end{pgfonlayer}}

\newcommand{\out}[3]{%
	\path [dashedline] (#1.east) -- node [above]
	{\scriptsize Output: #2} (#3);}


\tikzstyle{funtool}=[blue ,line  width =1pt]
\tikzstyle{ur}=[draw, text centered, color=blue, minimum height=0.01em]
\definecolor{light-gray}{gray}{0.93}
\newcommand{\fun}[3]{%
	\path [dashedline] (#1.east) -- node [above]
	{\scriptsize #2} (#3);}

\mode<presentation>

\begin{document}
%Titlefolie	
	\author{Antonie Vietor}
	\title[Analyse von RAD-Seq-Daten]{Analyse von RAD-Seq-Daten unter Berücksichtigung von Sequenzierfehlerraten und Heterozygotiewahrscheinlichkeiten}
	\date{4. März 2021}
	\setbeamercovered{transparent}		
	%Ausschalten der Navigationssymbole
	\setbeamertemplate{navigation symbols}{} 	

%Titlefolie	Inhalt
\begin{frame}[plain]
	\maketitle
	%Logo fuer Titelseite mit Positionierung oben links
	\begin{textblock*}{4.5cm}(0cm,-7.0cm)
	\includegraphics[width=4.5cm]{tud_logo_rgb}
	\end{textblock*}

	%Lehrstuhlbezeichnung mit Positionierung unten links
	\begin{minipage}[b]{0.55\textwidth}
		\scriptsize
		Technische Universität Dortmund\\
		Fakultät für Informatik\\
		Lehrstuhl 11\\
		Bioinformatics for High-Throughput Technologies\\
		http://ls11-www.cs.tu-dortmund.de/
	\end{minipage}
	\begin{minipage}[b]{0.44\textwidth}
		\scriptsize
		\begin{flushright}
		In Kooperation mit:\\
		Universität Duisburg-Essen\\
		Genome Informatics\\
		http://genomeinformatics.uni-due.de/
		\end{flushright}				
	\end{minipage}
\end{frame}

%Zentrierung der Titel aller Folien
\setbeamertemplate{frametitle}[default][center]

%Folie 2
\section{Biologischer Hintergrund}
\subsection{Aufbau von DNA und RNA}
\begin{frame}
	\frametitle{Aufbau von DNA und RNA}
	\vspace {-0.1cm}
	\begin{block}{Aufbau der DNA}
		\begin{itemize}
			\item besteht aus Nukleotiden			
			\item jedes \textbf{Nukleotid} besteht aus einem Zuckermolekül (Desoxyribose), einem Phosphatrest und einer Base
			\item \textbf{Basen}: A (Adenin), T (Thymin), G (Guanin), C (Cytosin)
			\item meist \textbf{doppelsträngig}	
			\item dient vor allem der \textbf{Informationsspeicherung} (Erbinformation)
		\end{itemize}
	\end{block}
	\vspace {-0.1cm}
	\visible<2->{\begin{block}{Unterschiede im Aufbau der RNA}
		\begin{itemize}
			\item \textbf{Nukleotide}: das Zuckermolekül ist Ribose
			\item \textbf{Basen}: Uracil (U) statt Thymin	
			\item meist \textbf{einzelsträngig}	
			\item viele Funktionen, dient unter anderem der \textbf{Informationsübertragung} bei der Proteinbiosynthese		
		\end{itemize}
	\end{block}}
\end{frame}

%%Folie 3
\section{Biologischer Hintergrund}
\subsection{Struktur der DNA}
\begin{frame}
	\frametitle{Struktur der DNA}
	\vspace {-0.1cm}
	\begin{block}{}
		\vspace{0.5cm}
		\begin{itemize}
			\item \textbf{Doppelhelixstruktur}
			\item \textbf{Komplementarität}: selektive Basenpaarung von A und T und ebenso  von G und C
			\item \textbf{Antiparallelität}: in der Doppelhelix sind die beiden DNA-Stränge gegenläufig zu einander
			\item \textbf{Gene}: Wechsel von codierenden (Exons) und nicht-codierenden Abschnitten (Introns)
			\item zwischen den Genen nicht-codierende Bereiche, z.T. mit regulatorischen Funktionen
			\item ca. 98 \% der DNA sind nicht-codierend
		\end{itemize}
		\vspace{0.5cm}
	\end{block}
\end{frame}

%%Folie 4
\section{Biologischer Hintergrund}
\subsection{Proteinbiosyntese}
\begin{frame}
	\frametitle{Proteinbiosynthese}
	\vspace{-0.5cm}
	\begin{columns}[T]
		\begin{column}{0.49\textwidth}
				\begin{block}{Genetischer Code}
				\begin{itemize}
					\item Codierung der \textbf{DNA-Sequenz} in eine \textbf{Aminosäuresequenz}, welche die Primärstruktur der Proteine darstellt
					\item \textbf{Basentripletts} (Codons) codieren für i.d.R. 20 Aminosäuren sowie ein Start- und drei Stop-Codons					
					\item \textbf{Degeneration}: mehrere Basentripletts können für die gleiche Aminosäure codieren
				\end{itemize}
			\end{block}
		\end{column}
		\begin{column}{0.49\textwidth}
			\begin{center}
				\begin{figure} 
					\includegraphics[width = 5 cm] {pictures/Aminoacids_table.png}	
				\end{figure}
			{\tiny Bildquelle: \cite{genetic_code}}
			\end{center}
		\end{column}
	\end{columns}
\end{frame}

%%Folie 5
\section{Biologischer Hintergrund}
\subsection{Proteinbiosyntese}
\begin{frame}
	\frametitle{Proteinbiosyntese}
	\vspace{-0.15cm}
	\begin{onlyenv}<2>
		\begin{center}
			\begin{figure} 
				\includegraphics[width = 12 cm] {pictures/transcription.jpg}
				{\tiny Bildquelle: \cite{transcript}}
				
			\end{figure}
		\end{center}
	\end{onlyenv}
	\begin{onlyenv}<6>
		\begin{center}
			\begin{figure} 
				\includegraphics[width = 6 cm] {pictures/trna.jpeg}\\
				{\tiny Bildquelle: \cite{trna}}
			\end{figure}
		\end{center}
	\end{onlyenv}
	\begin{onlyenv}<9>
		\begin{center}
			\begin{figure} 
				\includegraphics[width = 12 cm] {pictures/translation.jpg}
				{\tiny Bildquelle: \cite{translat}}
			\end{figure}
		\end{center}
	\end{onlyenv}
	\begin{onlyenv}<1>
%		\begin{itemize}
%			\item Übersetzung der Basensequenz der DNA in die Aminosäuresequenz der Proteine
%		\end{itemize}
		\begin{block}{Transkription}
			\textbf{Umschreiben} eines DNA-Abschnitts zu Arbeitskopien in Form von \textbf{mRNA} (messenger RNA)
		\end{block}	
	\end{onlyenv}
	\begin{onlyenv}<3-5,7->
		\begin{block}{Translation}
			\begin{itemize}
				\visible<3->{\item \textbf{Übersetzen} der Basensequenz in die Aminosäuresequenz mit Hilfe von \textbf{tRNA} (transfer RNA)
				\vspace{-0.05cm}}				
				\visible<4->{
				\item Aufbau der tRNA:
				\item[] $\Rightarrow$ \textbf{mRNA-Bindungsstelle} bestehend aus einem Basentriplett
				\vspace{-0.05cm}}
				\visible<5->{
				\item[] $\Rightarrow$ trägt die \textbf{korrespondierende Aminosäure} (AS), die nach dem genetischen Code der mRNA-Bindungsstelle entspricht
				\vspace{-0.05cm}}
				\visible<8->{
				\item von der Startsequenz ausgehend werden die tRNAs mit komplementärer Bindungsstelle nacheinander an die mRNA gebunden, dadurch wird ihre AS gelöst und an die AS der nachfolgenden tRNA gebunden
				\vspace{-0.05cm} $\Rightarrow$ es entsteht eine \textbf{Aminosäuresequenz}}
			\end{itemize}
		\end{block}
	\end{onlyenv}
\end{frame}

%%Folie 6
\section{Biologischer Hintergrund}
\subsection{DNA-Replikation}
\begin{frame}
	\frametitle{DNA-Replikation}
	\begin{onlyenv}<5>
		\begin{center}
			\begin{figure} 
				\includegraphics[width = 12 cm] {pictures/repl_complex.png}
				{\tiny Bildquelle: \cite{repl_complex}}
				
			\end{figure}
		\end{center}
	\end{onlyenv}
	\begin{onlyenv}<1-4,6-10>
		\begin{block}{}
			Natürlicher Vorgang zur Vervielfältigung der DNA bei der Zellteilung:
			\begin{enumerate}
				{\setlength{\itemindent}{1.5em}
					\visible<1->{\item Entwindung der DNA (\textbf{Topoisomerasen})}
					\visible<2->{\item Auftrennung des DNA-Doppelstrangs (\textbf{Helikase})}
					\visible<3->{\item Synthese der RNA-Primer (\textbf{Primasen})}
					\visible<4->{\item Kopieren der beiden Elternstränge ausgehend von den\\\hspace{0.5cm} RNA-Primern (\textbf{DNA-Polymerasen})}
					\visible<7->{\item[] $\Rightarrow$ es entstehen zwei komplementäre Tochterstränge}	
					\visible<8->{\item[] $\Rightarrow$ kontinuierliche Synthese des Leitstrangs}	
					\visible<9->{\item[] $\Rightarrow$ diskontinuierliche Synthese des Folgestrangs\\\hspace{1.1cm}(Okazaki-Fragmente)}					
					\visible<10->{\item Verbindung der Okazaki-Fragmente des  Folgestrangs (\textbf{Ligase})}
				}
			\end{enumerate}
		\end{block}
	\end{onlyenv}
\end{frame}

\definecolor{greenbl}{HTML}{00a27a}
\definecolor{lila}{HTML}{5100d7}
\definecolor{dunkelrot}{HTML}{fa0004}

%%Folie 7
\section{Biologischer Hintergrund}
\subsection{Mutationen und Varianten}
\begin{frame}
	\frametitle{Mutationen}
		\begin{onlyenv}<1>
		\begin{center}
			\begin{figure} 
				\includegraphics[width = 10 cm] {pictures/mutation_macro.jpg}\\
				{\tiny Bildquelle: \citep{mutation}}
				
			\end{figure}
		\end{center}
		\end{onlyenv}
		\begin{onlyenv}<2>
			\begin{center}
				\begin{figure} 
					\includegraphics[width = 12 cm] {pictures/mutation_micro.jpg}
					{\tiny Bildquelle: \citep{mutation}}
					
				\end{figure}
			\end{center}
		\end{onlyenv}
		\begin{onlyenv}<3>
			\begin{center}
				\begin{minipage}{\linewidth}
				\centering
				\resizebox{12cm}{!}{
					\begin{tikzpicture}
					[sibling distance=25em,
					every node/.style = {shape=rectangle, rounded corners,
						draw, align=center,
						top color=white, bottom color=green!50},transform shape]
					\node [top color=white, bottom color=red!50] (p0) {\textbf {Punktmutationen}}
					child { node [top color=white, bottom color=red!50]  (p1) {Substitution} [sibling distance=6em]
						child { node [top color=white, bottom color=greenbl!50, below left = 4cm of p1] (p2) {Aminosäure\\unverändert} [sibling distance=6em]
							child { node [top color=white, bottom color=lila!50, below = 2.2cm of p2] (p3) {silent} [sibling distance=6em]}}
						child { node [top color=white, bottom color=greenbl!50, right = 7.5cm of p2] (p4) {Aminosäure\\ändert sich} [sibling distance=12em] 
							child { node [top color=white, bottom color=greenbl!50] (p5) {zu anderer Aminosäure}
								child{ node [top color=white, bottom color=lila!50] (p6) {missense} } } 
							child { node [top color=white, bottom color=greenbl!50] (p7) {Stop-Codon entsteht}
								child { node [top color=white, bottom color=lila!50] (p8) {nonsense} } }
							child { node [top color=white, bottom color=greenbl!50] (p9) {Stop-Codon entfernt}
								child { node [top color=white, bottom color=lila!50] (p10) {readthrough} } } } } 
					child { node [top color=white, bottom color=red!50] (p11) {Insertion oder Deletion}[sibling distance=12em]
						child { node [top color=white, bottom color=greenbl!50] (p12) {frameshift}
							 }
						child { node [top color=white, bottom color=greenbl!50] (p13) {non-frameshift} 
					  		child { node [top color=white, bottom color=greenbl!50, below = 1.35cm of p13] (p14) {einzelne Aminosäure\\fehlt oder ist dupliziert} } } };
					\draw (p12.south) edge (p4.north east) ;
					\end{tikzpicture} 
				}
				\end{minipage}
			\end{center}
		\end{onlyenv}
\end{frame}

%%Folie 8
\section{Biologischer Hintergrund}
\subsection{Mutationen und Varianten}
\begin{frame}
	\frametitle{}
	\vspace {-0.1cm}
	\begin{block}{Folgen von Mutationen}
		\begin{itemize}
			\item Loss-of-function-Mutationen			
			\item Gain-of-function-Mutationen
		\end{itemize}
	\end{block}
	\vspace {-0.1cm}
	\visible<2->{\begin{block}{Varianten}
		\begin{itemize}
			\item oft Varianten einzelner Basen: SNPs (single nucleotide polymorphism)
			\item ohne pathologische Auswirkungen
			\item vermehrtes Auftreten innerhalb einer Spezies		
		\end{itemize}
	\end{block}}
	\vspace {-0.1cm}
	\visible<3->{\begin{block}{Allele, Locus, Ploidie und Genotyp}
		\begin{itemize}
			\item \textbf{Allele}: verschiedene Varianten eines genomischen Ortes (\textbf{Locus})
			\item \textbf{Ploidie}: Anzahl der Chromosomensätze (\textbf{homologe Chromosomen})		
			\item \textbf{Genotyp}:
				\item[] $\Rightarrow$ \textbf{Homozygotie}: an einem Locus liegt auf allen homologen\\\hspace{0.5cm}Chromosomen das gleiche Allel vor
				\item[] $\Rightarrow$ \textbf{Heterozygotie}: die homologen Chromosomen weisen an einem\\\hspace{0.5cm}Locus unterschiedliche Allele auf
		\end{itemize}
	\end{block}}
\end{frame}

%%Folie 9
\section{Biologischer Hintergrund}
\subsection{PCR}
\begin{frame}
	\frametitle{Polymerase-Kettenreaktion (PCR)}
	\vspace {-0.3cm}
	\begin{onlyenv}<5>
		\begin{center}
			\begin{figure} 
				\includegraphics[width = 10 cm] {pictures/pcr_steps.png}\\
				{\tiny Bildquelle: \citep{pcr}}			
			\end{figure}
		\end{center}
	\end{onlyenv}
	\begin{onlyenv}<8>
	\begin{center}
		\begin{figure} 
			\includegraphics[width = 11 cm] {pictures/pcr_compl_1.png}
			{\tiny Bildquelle: \citep{pcr}}			
		\end{figure}
	\end{center}
	\end{onlyenv}
	\begin{onlyenv}<9>
		\begin{center}
			\begin{figure} 
				\includegraphics[width = 11 cm] {pictures/pcr_compl_2.png}
				{\tiny Bildquelle: \citep{pcr}}			
			\end{figure}
		\end{center}
	\end{onlyenv}
	\begin{onlyenv}<10>
		\begin{center}
			\begin{figure} 
				\includegraphics[width = 11 cm] {pictures/pcr_compl_3.png}
				{\tiny Bildquelle: \citep{pcr}}			
			\end{figure}
		\end{center}
	\end{onlyenv}
	\begin{onlyenv}<11>
		\begin{center}
			\begin{figure} 
				\includegraphics[width = 11 cm] {pictures/pcr_compl_4.png}
				{\tiny Bildquelle: \citep{pcr}}			
			\end{figure}
		\end{center}
	\end{onlyenv}
	\begin{onlyenv}<1-4,6-7>
		\begin{block}{}
			\begin{itemize}
				\item Methode zur Vervielfältigung von DNA-Abschnitten			
				\item mehrere Zyklen der folgenden temperaturabhängigen Schritte:
				\begin{enumerate}
					\vspace {0.1cm}
					\visible<2->{\item \textbf{Denaturierung}: durch Erhitzen wird der DNA-Doppelstrang in zwei Einzelstränge aufgespalten (96°C)}
					\vspace {0.2cm}
					\visible<3->{\item \textbf{Annealing}: Primerbindung an den 3'-Enden der zu amplifizierenden Gensequenz beider Einzelstränge (55-65°C)}
					\vspace {0.2cm}
					\visible<4->{\item \textbf{Elongation}: DNA-Synthese der komplementären Stränge (72°C)
					\vspace{0.1cm}}
				\end{enumerate}
				\visible<7->{
				\item mit jedem Zyklus wird die betreffende Sequenz verdoppelt
				\item in Abhängigkeit von der Anzahl der durchgeführten Zyklen $n$ exponentieller Anstieg der Kopien $2^n$}
			\end{itemize}
		\end{block}
	\end{onlyenv}
\end{frame}


%%Folie 10
\section{Biologischer Hintergrund}
\subsection{Sequenzierung}
\begin{frame}
	\frametitle{Sequenzierung}
	\begin{onlyenv}<2>
		\begin{center}
			\begin{figure} 
				\includegraphics[width = 10 cm] {pictures/sanger.png}\\
				{\tiny Bildquelle: \citep{sanger}}			
			\end{figure}
		\end{center}
	\end{onlyenv}
	\begin{onlyenv}<1,3-5>
%		\visible<1->{\begin{block}{} Bestimmung der Basensequenz eines DNA-Strangs\end{block}}
		\vspace{-0.1cm}
		\visible<1->{\begin{block}{Sanger-Sequenzierung} Kettenabbruch-Synthese mit vier Probenansätzen denen jeweils eine der vier möglichen Nukleotide in modifizierter Form beigefügt wird\end{block}}
		\vspace{-0.1cm}
		\visible<4->{\begin{block}{NGS-Sequenzierung} verbesserte Sequenziertechnologien im Hochdurchsatzverfahren\end{block}}
		\vspace{-0.1cm}
		\visible<5->{\begin{block}{RAD-Sequenzierung}
			\begin{itemize}
				\item restriction site associated DNA sequencing 
				\item \textbf{Anwendung}: Populationsgenetik, Ökologie, Genotypisierung, Evolutionsforschung
				\item Sequenzierung multipler kleiner DNA-Fragmente aus dem gesamten Genom
				\item gleichzeitige Analyse mehrerer Individuen in gepoolten Proben
				\item benötigt kein Referenzgenom
			\end{itemize}
		\end{block}}
	\end{onlyenv}
\end{frame}

%%Folie 11
\section{Biologischer Hintergrund}
\subsection{RAD-Sequencing}
\begin{frame}
	\frametitle{RAD-Verfahren}
	\begin{onlyenv}<1-4,6-7>
		\vspace*{-0.2cm}
		\begin{block}{Restriktionsenzyme}
			\begin{itemize}
				\item molekulare Scheren, welche die DNA an spezifischen Sequenzen schneiden
				\item Enden können glatt oder versetzt sein
			\end{itemize}
		\end{block}
	\end{onlyenv}
 	\begin{onlyenv}<4,6-7>
 		\vspace*{-0.1cm}
 		\begin{block}{Methode}
 			\begin{enumerate}
 				\item \textbf{DNA-Verdau} durch Restriktionsenzyme
 				\item Sequenz der Restriktionsstelle ist bekannt, dies ermöglicht die Bindung der \textbf{Adapter-} und \textbf{Barcodesequenzen}
 				\item \textbf{Größenselektion} der DNA-Fragmente
 				\item \textbf{Sequenzierung} der gepoolten Proben verschiedener Individuen
 			\end{enumerate}
 		\end{block}
 	\end{onlyenv}
  	\begin{onlyenv}<7>
  		\vspace*{-0.1cm}
	 	\begin{block}{ddRADSeq (double digest RAD sequencing)}
	 		\begin{itemize}
	 			\item Verwendung von zwei verschiedenen Restriktionsenzymen
	 			\item bessere Steuerbarkeit und höhere Genauigkeit
	 		\end{itemize}	 		
	 	\end{block}
	 \end{onlyenv}
 	\begin{overlayarea}{\textwidth}{\textheight}
 	\begin{onlyenv}<2-3,5> 		
% 		\only<9>{\vspace*{-0.1cm}}
 		\begin{center}
 			\begin{figure} 
 				\only<2-3>{\vspace*{0.2cm}}
 				\includegraphics<2>[width = 0.14\textwidth] {pictures/plane.png} 				
 				\hspace*{0cm}	
 				\includegraphics<3>[width = 0.14\textwidth] {pictures/sticky.png}
 				\only<2>{{\tiny \\Bildquelle: \citep{restr_plane}}}	
 				\only<3>{{\tiny \\Bildquelle: \citep{restr_sticky}}}
 				\includegraphics<5>[width = 0.8\textwidth] {pictures/rad-sequencing_white.png}
 				\only<5>{\vspace*{-0.1cm}}
 				\only<5>{{\tiny \\Bildquelle: \citep{radseq} (modifiziert)}}	
 	 			\end{figure}
		 	\end{center}
		\end{onlyenv}
	\end{overlayarea}
\end{frame}

%%Folie 12
\section{Biologischer Hintergrund}
\subsection{RAD-Sequencing}
\begin{frame}
	\frametitle{RADSeq-Verfahren}
	\begin{itemize}
		\item durch die \textbf{Sequenzspezifität der Restriktionsenzyme} stammen die DNA-Fragmente bei den verschiedenen Individuen meistens vom gleichen genomischen Locus	
		\vspace*{0.15cm}	
		\item interindividueller Vergleich ist \textbf{ohne Referenzgenom} möglich
		\vspace*{0.15cm}	
		\item \textbf{gepoolte Proben}: Zeit- und Kostenersparnis, gleiche Versuchsbedingungen für die verschiedenen Individuen
		\vspace*{0.15cm}	
		\item die DNA-Fragmente stammen aus dem gesamten Genom, aber \textbf{keine vollständige genomische Abdeckung}
	\end{itemize}
\end{frame}

%%Folie 13
\section{Analyse von RAD-Seq-Daten}
\subsection{Problemstellung und Lösungsansatz}
\begin{frame}
	\frametitle{Problemstellung}
	\visible<1->{
	\vspace*{-0.1cm}
	\textbf{Problem:}
	\begin{itemize}
		\item Reads ohne Kenntnis eines Referenzgenoms möglichen Loci zuordnen
		\item die Loci und ihre Sequenz sind unbekannt
	\end{itemize}}
\visible<2->{
	\textbf{Gegeben:}
	\begin{itemize}
		\item Menge von Reads: $ D = (s_{1}, \dots , s_{m}) \in \{A,\,C,\,G,\,T,\}^{k^m}$
		\item Qualität der Sequenzierung: $ Q = (q_{1}, \dots , q_{m}) \in {[0,\,1]}^{k^m}$
		\item Sequenzierfehlerraten: $\epsilon=\{\epsilon_{ins},\, \epsilon_{del}\}$
		\item Heterozygotiewahrscheinlichkeiten: $\eta=\{\eta_{sub},\, \eta_{ins},\, \eta_{del}\}$ 		
		\item Ploidie: $\phi$
	\end{itemize}}
\visible<3->{
	\textbf{Ziel:}\\
	\begin{itemize}
		\item Zuordnung der Reads zu den Loci unter Berücksichtigung von $\epsilon$ und $\eta$
		\item Ausgabe der Menge der ermittelten Loci mit den Sequenzen der beteiligten Allele
	\end{itemize}
	\vspace*{0.1cm}
	$\Rightarrow$ die Loci können anschließend für Diversitätsanalysen genutzt werden}	
\end{frame}

%%Folie 14
\section{Model und Implementierung}
\subsection{Model}
\begin{frame}
	\frametitle{Model}
	\begin{minipage}[t]{\textwidth}	
		\centering
		\scalebox{0.6}{
			\smartdiagramset{sequence item height=2.5cm,
				uniform color list=gray!60 for 5 items, border color=black}
			\only<1>{\smartdiagramset{set color
					list={red!60,blue!20,blue!20,blue!20,blue!20}}}
			\only<2>{\smartdiagramset{set color
					list={blue!20,red!60,blue!20,blue!20,blue!20}}}
			\only<3>{\smartdiagramset{set color
					list={blue!20,blue!20,red!60,blue!20,blue!20}}}
			\only<4>{\smartdiagramset{set color
					list={blue!20,blue!20,blue!20,red!60,blue!20}}}
			\only<5>{\smartdiagramset{set color
					list={blue!20,blue!20,blue!20,blue!20,red!60}}}
			\smartdiagramanimated[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
		}
	\end{minipage}
\end{frame}

%%Folie 15
\section{Model und Implementierung}
\subsection{Model - Preprocessing}
\begin{frame}
	\frametitle{Model - Preprocessing}
	\only<1->{
	\begin{minipage}[t][2cm][t]{\textwidth}	
		\centering
		\scalebox{0.6}{
			\smartdiagramset{sequence item height=2.5cm,
				uniform color list=gray!60 for 5 items, border color=black}
			\only<1>{\smartdiagramset{set color
					list={blue!20,blue!20,blue!20,blue!20,blue!20}}}
			\only<2->{\smartdiagramset{set color
					list={red!60,blue!20,blue!20,blue!20,blue!20}}}
			\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
		}
	\end{minipage}}
	\only<1->{
	\begin{minipage}[t][10cm][t]{\textwidth}	
		\only<3>{
		\begin{itemize}
			\item Statistiken zur Qualität der Reads
			\item Individuen werden entsprechend ihres Barcodes separiert
			\item Entfernen der Barcode- und Adaptersequenzen
			\item Erzeugen eines Sequenzalignments
		\end{itemize}
		}
	\end{minipage}}
\end{frame}	

%%Folie 16
%%Preprocessing
\section{Model und Implementierung}
\subsection{Implementierung - Preprocessing}
\begin{frame}
	\frametitle{Implementierung - Preprocessing}
	\begin{minipage}[t][2cm][t]{\textwidth}	
		\centering
		\scalebox{0.6}{
			\smartdiagramset{sequence item height=2.5cm,
				uniform color list=gray!60 for 5 items}
			\only<1->{\smartdiagramset{set color
					list={red!60,blue!20,blue!20,blue!20,blue!20}}}
			\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
		}
	\end{minipage}
	
	\begin{minipage}[t][10cm][t]{\textwidth}	
		\only<2-5>{
			\begin{figure}
				\begin{center}
					\begin{tikzpicture}[scale=0.5,transform shape]
					% https://github.com/PetarV-/TikZ/tree/master/DNA
					\path \ioitem {1}{Reads\\
						\begin{tikzpicture}[scale=0.6,transform shape]
						\bond{red}{blue}{0.1}
						\bond{red}{blue}{0.25}
						\bond{red}{blue}{0.4}
						\bond{blue}{red}{1.1}
						\bond{blue}{red}{1.25}
						\bond{blue}{red}{1.4}
						\bond{red}{blue}{2.1}
						\bond{red}{blue}{2.25}
						\bond{red}{blue}{2.4}
						\bond{blue}{red}{3.1}	
						\bond{blue}{red}{3.25}
						\bond{blue}{red}{3.4}
						\bond{red}{blue}{4.1}
						\bond{red}{blue}{4.25}
						\bond{red}{blue}{4.4}
						\braid[rotate=90,style strands={1}{red, very thick},style strands={2}{blue, very thick}] (tst) at (0, 0) s_1 s_1 s_1 s_1 ;
						\end{tikzpicture}
					};
					\path (p1.south)+(0.0,-2.0) \blockitem{2}{1. Adapter trimming};
					\path (p2.south)+(2.5,-1.2) \blockitem{3}{2. Quality \\control};
					\path (p3.south)+(-2.5,-1.2) \blockitem{5}{3. Sequence alignment};
					\visible<3-5>{\path (p3.east)+(+4.4, 1.801) node (ur1)[ur] {\color{black}Cutadapt};}
					\visible<4-5>{\path (p1.east)+(+7.5,-4.42) node (ur2)[ur] {\color{black}FastQ, MultiQC};}
					\visible<5>{\path (p2.east)+(+7.0,-3.59) node (ur3)[ur] {\color{black}Minimap2};}
					
					% Pfeile
					\path [line] (p1.south) -- node [above, midway] {} (p2);
					\path [line] (p2.south) -- node [above] {} (p3) ;
					\path [line] (p3.south) -- node [above] {} (p5) ;
					
					\visible<3-5>{\draw [funtool] (p2) -- (ur1);}
					\visible<4-5>{\draw [funtool] (p3) -- (ur2);}
					\visible<5>{\draw [funtool] (p5) -- (ur3);}							
				\end{tikzpicture}
			\end{center}
		\end{figure}
	}
\end{minipage}
\end{frame}	
	
%%Folie 17
\section{Model und Implementierung}
\subsection{Model - Graphkonstruktion}
\begin{frame}
	\frametitle{Model - Graphkonstruktion}
	\only<1->{
		\begin{minipage}[t][2cm][t]{\textwidth}	
			\centering
			\scalebox{0.6}{
				\smartdiagramset{sequence item height=2.5cm,
					uniform color list=gray!60 for 5 items, border color=black}
				\only<1->{\smartdiagramset{set color
						list={blue!20,red!60,blue!20,blue!20,blue!20}}}
				\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
			}
	\end{minipage}}
	\only<1->{		
		\begin{minipage}[t][10cm][t]{\textwidth}	
			\only<2>{
				\begin{itemize}
					\item das Problem wird als gerichteter Graph $G=(V, \, E)$ betrachtet
					\item die Knoten werden durch die Reads repräsentiert
					\item die Kanten basieren auf dem Sequenzalignment
					\item das Sequenzalignment wird als approximiertes pairHMM betrachtet
				\end{itemize}
			}
	\end{minipage}}
\end{frame}		
	
%%Folie 18
\section{Model und Implementierung}
\subsection{Approximation des pairHMM}
\begin{frame}
	\frametitle{Paarweiser Sequenzvergleich - pairHMM vs. Minimap2}	
		\only<1-2>{
		\vspace*{-0.2cm}
		\begin{block}{pair Hidden Markov Model (pairHMM)}
			\begin{itemize}
				\only<1>{
					\item das beobachtete Ergebnis der Referenzsequenz wird durch Abfolgen von \textbf{Mismatch-, Insertions- und Deletions-Operationen} der Querysequenz erklärt 
					\vspace*{0.1cm}
					\item jede Operation ist ein Zustand, die \textbf{Zustände sind nicht direkt beobachtbar}
					\vspace*{0.1cm}
					\item \textbf{Zustandsübergangswahrscheinlichkeiten}
					\vspace*{0.1cm}
					\item \textbf{Emissionswahrscheinlichkeiten}: Wahrscheinlichkeit, dass eine
					Base aus einem bestimmten Zustand heraus tatsächlich emittiert wird, d.h. in der Readsequenz zu beobachten ist}
					\only<2>{
					\item mögliche Kombinationen von Zustandsübergängen, die zum beobachteten Ergebnis der Referenzsequenz führen, können aber errechnet und als \textbf{Matrix} dargestellt werden
					\vspace*{0.1cm}
					\item in der Matrix werden alle \textbf{Pfade} ermittelt, deren Zustandssequenzen geeignet sind, die Querysequenz in die Referenzsequenz zu transformieren
					\vspace*{0.1cm}
					\item Aus den Zustandsübergangs- und Emissionswahrscheinichkeiten dieser
					Pfade kann dann die \textbf{Gesamtlikelihood} bestimmt werden, dass die Querysequenz aus der Referenzsequenz entstanden ist}								
			\end{itemize}
		\only<2>{\vspace*{0.1cm}
		$\Rightarrow$ Kantengewichtung des Graphen: \textbf{Gesamtlikelihood aus allen Pfaden} des pairHMM}
		\end{block}}
	
		\only<3>{
		\vspace*{-0.2cm}
		\begin{block}{Sequenzalignment von Minimap2}
			\begin{itemize}
				\item ebenfalls paarweiser Vergleich der Readsequenzen
				\vspace*{0.1cm}
				\item Reads mit hoher Ähnlichkeit zueinander werden in das Alignment aufgenommen
				\vspace*{0.1cm}
				\item Mapping der Reads, die eine hohe Wahrscheinlichkeit besitzen, durch Sequenzierfehler, Variationen oder Mutationen aus einem gemeinsamen Allel hervorgegangen zu sein		
				\vspace*{0.1cm}
				\item das Mapping entspricht dem \textbf{wahrscheinlichsten Pfad der pairHMM-Matrix}
				\vspace*{0.1cm}
				\item  dieser Pfad würde auch das Ergebnis des pairHMM dominieren \textrightarrow Approximation				
			\end{itemize}
		\vspace*{0.1cm}
		$\Rightarrow$ Kantengewichtung des Graphen: \textbf{Likelihood des wahrscheinlichsten Pfades} des pairHMM
		\end{block}}
\end{frame}

%%Folie 19
\section{Model und Implementierung}
\subsection{Approximation des pairHMM}
\begin{frame}
	\frametitle{Likelihoodberechnung beim approximierten pairHMM}
	\begin{columns}[T]
		\begin{column}{0.52\textwidth}
			\begin{center}
				\textbf{Likelihood der Allele bei einem gegebenen Read}
			\end{center}
				\color{blue}\[L_{match} = 1 - p_{i}\]
%				\vspace*{0.2cm}
				\color{blue}\[L_{indel} \in \{\epsilon_{ins}, \epsilon_{del}\}\]
%				\vspace*{0.2cm}
				\color{blue}\[L_{sub} = \frac{1}{3} \; \cdotp \; p_{i}\]
%				\vspace*{0.7cm}
				\color{red} \[pHMM_{\epsilon, q_{query}} \;(s_{query}\;|\; s_{ref}) \approx \prod_{i=1}^{k}L_{i}\]
		\end{column}
		\begin{column}{0.47\textwidth}
			\begin{center}
				\textbf{Likelihood bei der Zuordnung der Allele zu möglichen Loci}
			\end{center}
				\color{blue} \[L_{match} = 1 - (\eta_{sub} + \eta_{ins} + \eta_{del})\] 
				\vspace*{0.5cm}
				\color{blue} \[L_{mismatch} \in  \{\,\eta_{sub},\, \eta_{ins},\, \eta_{del}\,\}\]
				\vspace*{0.75cm}		
%				\hline
				\color{red} \[pHMM_{\eta}(a_{l_{j,query}} \, | \, a_{l_{j,ref}}) \approx \prod_{i=1}^{k}L_{i}\]
		\end{column}
	\end{columns}
\end{frame}

%%Folie 20
\section{Model und Implementierung}
\subsection{Model - Graphkonstruktion}
\begin{frame}
	\frametitle{Model - Graphkonstruktion}
	\only<1->{
		\begin{minipage}[t][2cm][t]{\textwidth}	
			\centering
			\scalebox{0.6}{
				\smartdiagramset{sequence item height=2.5cm,
					uniform color list=gray!60 for 5 items, border color=black}
				\only<1->{\smartdiagramset{set color
						list={blue!20,red!60,blue!20,blue!20,blue!20}}}
				\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
			}
	\end{minipage}}

	\only<1->{
		\begin{minipage}[t][10cm][t]{\textwidth}	
			\only<1-2>{
				\begin{itemize}
					\item das Problem wird als gerichteter Graph $G=(V, \, E)$ betrachtet
					\item die Knoten werden durch die Reads repräsentiert
					\item die Kanten basieren auf dem Sequenzalignment
					\item das Sequenzalignment wird als approximiertes pairHMM betrachtet
					\visible<2->{\item Kanten entstehen nur zwischen Knoten deren Readsequenzen einander ähneln
					\item Partitionierung des Graphen in mehrere Zusammenhangskomponenten $\Rightarrow$ das Gesamtproblem wird in mehrere Teilprobleme aufgeteilt}
				\end{itemize}
			}
			\only<3>{
				\begin{itemize}
					\item \textbf{Grapheigenschaften}:
					\begin{itemize}
						\item Ploidie
						\item Sequenzierfehlerraten für Insertionen und Deletionen
						\item Heterozygotiewahrscheinlichkeiten für Substitutionen und Indels
					\end{itemize}
					\item \textbf{Knoteneigenschaften}:
					\begin{itemize}
						\item ID
						\item Basensequenz
						\item Basenqualität
					\end{itemize}
					\item \textbf{Kanteneigenschaften}:
					\begin{itemize}
						\item CIGAR-Tupel
						\item Edit-Distanz
					\end{itemize}
					
				\end{itemize}
			}
	\end{minipage}}
\end{frame}	

%%Folie 21
%%Konstruktion des Graphen
\section{Model und Implementierung}
\subsection{Implementierung - Graphkonstruktion}
\begin{frame}
	\frametitle{Implementierung - Graphkonstruktion}
	\begin{minipage}[t][3cm][t]{\textwidth}	
		\centering
		\scalebox{0.6}{
			\smartdiagramset{sequence item height=2.5cm,
				uniform color list=blue!20 for 5 items}
			\only<1->{\smartdiagramset{set color
					list={blue!20,red!60,blue!20,blue!20,blue!20}}}
			\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
		}
	\end{minipage}
	
	\begin{minipage}[t][10cm][t]{\textwidth}	
		\only<2->{
			\vspace*{-1.0cm}
			\begin{figure}[h]
				\begin{center}
					\begin{tikzpicture}[scale=0.64,transform shape]
					% https://github.com/PetarV-/TikZ/tree/master/DNA
					\path +(3.695,-5.1) \ioitem {1}{Reads\\
						\begin{tikzpicture}[scale=0.6,transform shape]
						\bond{red}{blue}{0.1}
						\bond{red}{blue}{0.25}
						\bond{red}{blue}{0.4}
						\bond{blue}{red}{1.1}
						\bond{blue}{red}{1.25}
						\bond{blue}{red}{1.4}
						\bond{red}{blue}{2.1}
						\bond{red}{blue}{2.25}
						\bond{red}{blue}{2.4}
						\bond{blue}{red}{3.1}	
						\bond{blue}{red}{3.25}
						\bond{blue}{red}{3.4}
						\bond{red}{blue}{4.1}
						\bond{red}{blue}{4.25}
						\bond{red}{blue}{4.4}
						\braid[rotate=90,style strands={1}{red, very thick},style strands={2}{blue, very thick}] (tst) at (0, 0) s_1 s_1 s_1 s_1 ;
						\end{tikzpicture}
					};
					\path (p3.south)+(-3.0,-1.2) \ioitem{5}{3. Sequence alignment};
					\path (p3.west)+(3.25,-3.66) \blockitem{4}{4. Build graph};
					\path (p4.south)+(0.0,-1.5) \blockitem{6}{5. Connected components};
					
					\visible<3>{\path (p4.east)+(+3.5,0) node (ur2)[ur] {\color{black}graph-tool};}
					\only<3>{\path (p6.east)+(+3.5,0) node (ur3)[ur] {\color{black}graph-tool};}
					\path (p6.south)+(0.0,-1.4) \ioitem{8}{6. Candidate \\alleles};
					
					% Pfeile		
					\path [line] (p1.south) -- node [above, midway] {} (p4);	
					\path [line] (p5.south) -- +(0.0,-1.415) -- node [above, midway] {} (p4.west);		
					\path [line] (p4.south) --node [above] {} (p6);
					\path [line] (p6.south) -- node [above, midway] {} (p8);
					
					\visible<3>{\draw [funtool] (p4) -- (ur2);}
					\visible<3>{\draw [funtool] (p6) -- (ur3);}
				\end{tikzpicture}
			\end{center}
		\end{figure}
	}
\end{minipage}
\end{frame}

%%Folie 22
\section{Model und Implementierung}
\subsection{Laufzeit - Graphkonstruktion}
\begin{frame}
	\frametitle{Laufzeit - Graphkonstruktion}
	\only<1->{
	\begin{minipage}[t][2cm][t]{\textwidth}	
		\centering
		\scalebox{0.6}{
			\smartdiagramset{sequence item height=2.5cm,
				uniform color list=gray!60 for 5 items, border color=black}
			\only<1->{\smartdiagramset{set color
					list={blue!20,red!60,blue!20,blue!20,blue!20}}}
			\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
		}
	\end{minipage}}
	\only<1->{
	\begin{minipage}[t][10cm][t]{\textwidth}	
		\begin{itemize}
			\item Erzeugung der Knoten: $ O(|V|) $
			\item Hinzufügen der Kanten: $ O(|E|\, \cdotp |V|) $
			\item Zusammenhangskomponenten: $ O(|V|^2 + |E|) $			
		\end{itemize}
	\vspace*{0.3cm}
		$\Rightarrow$ \textbf{Gesamtlaufzeit}: $ O(|V| \, \cdotp (|V| + |E|)) $
	\end{minipage}}		
\end{frame}

%%Folie 23
\section{Model und Implementierung}
\subsection{Model - Allele-Fractions}
\begin{frame}
	\frametitle{Model - Allele-Fractions}
	\only<1->{
		\begin{minipage}[t][2cm][t]{\textwidth}	
			\centering
			\scalebox{0.6}{
				\smartdiagramset{sequence item height=2.5cm,
					uniform color list=gray!60 for 5 items, border color=black}
				\only<1->{\smartdiagramset{set color
						list={blue!20,blue!20,red!60,blue!20,blue!20}}}
				\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
			}
	\end{minipage}}
	\only<1->{
	\begin{minipage}[t][10cm][t]{\textwidth}			
		\only<2-3>{
		\begin{itemize}
			\item Identifizierung der Allele, von denen die übrigen Reads der Zusammenhangskomponenten am wahrscheinlichsten durch Sequenzierfehler entstanden sind
			\visible<3>{\item Kandidatenallele und Anzahl der tatsächlich zu erwartenden Allele $n_{alleles}$ bestimmen:
			\begin{equation*}
					n_{alleles} =
					\left\{
					\begin{array}{ll}
					\phi, & \phi \geq n_{cand} \\
					n_{cand} + \phi - d, & \phi < n_{cand} \wedge d \neq 0\\
					n_{cand}, & \phi < n_{cand} \wedge d = 0
					\end{array}
					\right.
			\end{equation*}
			\hspace*{8.3cm}{\tiny (es gilt $d=n_{cand} \mod \phi$)}
			}
		\end{itemize}
		}
		\only<4-7>{
			$\Rightarrow$ aus den Kandidatenallelen \textbf{Kombinationen mit Wiederholung} der Länge $n_{alleles}$ gebildet:
			\only<5->{	
				\begin{itemize}
					\item[] \color{blue}$ ploidy = 2, n_{cand} = 2, n_{alleles} = 2$: \\
					\item[] \color{black}{[(0, 0), (0, 1), (1, 1)]}\\
				\end{itemize}													
			}
			\only<6->{
			\vspace*{0.5cm}
			$\Rightarrow$ aus den Kombinationen werden die Häufigkeitsverteilungen der Kandidatenallele (\textbf{Allele-Fractions}) bestimmt:}
			\only<7>{	
				\begin{itemize}
					\item[] \color{blue}$ ploidy = 2, n_{cand} = 2, n_{alleles} = 2$: \\
					\item[] \color{black}{[1.0, 0.0]}, {[0.5, 0.5]}, {[0.0, 1.0]} \\
				\end{itemize}
			}}				
		
		\only<8-9>{				
			\vspace*{-0.1cm}
			\textbf{Allelkombinationen:}	
				\begin{itemize}
					\item[] \color{blue}$ ploidy = 2, n_{cand} = 3, n_{alleles} = 4$: \\
					{\normalsize \item[] \color{black}{[(0, 0, 0, 0), (0, 0, 0, 1), (0, 0, 0, 2), (0, 0, 1, 1), (0, 0, 1, 2), \\\;(0, 0, 2, 2), (0, 1, 1, 1), (0, 1, 1, 2), (0, 1, 2, 2), (0, 2, 2, 2), \\\;(1, 1, 1, 1), (1, 1, 1, 2), (1, 1, 2, 2), (1, 2, 2, 2), (2, 2, 2, 2)]}}
				\end{itemize}	
			\only<9>{
			\vspace*{0.3cm}
			\textbf{Allele-Fractions:}	
				\begin{itemize}
					\item[] \color{blue}$ ploidy = 2, n_{cand} = 3, n_{alleles} = 4$: \\
					{\normalsize \item[] \color{black}{[1.0, 0.0, 0.0]}, {[0.75, 0.25, 0.0]}, {[0.75, 0.0, 0.25]}, {[0.5, 0.5, 0.0]}, \\{[0.5, 0.25, 0.25]}, {[0.5, 0.0, 0.5]}, {[0.25, 0.75, 0.0]}, {[0.25, 0.5, 0.25]}, \\{[0.25, 0.25, 0.5]}, {[0.25, 0.0, 0.75]}, {[0.0, 1.0, 0.0]}, {[0.0, 0.75, 0.25]}, \\{[0.0, 0.5, 0.5]}, {[0.0, 0.25, 0.75]}, {[0.0, 0.0, 1.0]}}
				\end{itemize}
		}}
	}
	\end{minipage}
\end{frame}

%%Folie 24
%%Kandidatenallele und Allele-Fractions
\section{Model und Implementierung}
\subsection{Implementierung - Allele-Fractions}
\begin{frame}
	\frametitle{Implementierung - Allele-Fractions}
	\begin{minipage}[t][2.8cm][t]{\textwidth}	
		\centering
		\scalebox{0.6}{
			\smartdiagramset{sequence item height=2.5cm,
				uniform color list=blue!20 for 5 items}
			\only<1->{\smartdiagramset{set color
					list={blue!20,blue!20,red!60,blue!20,blue!20}}}
			\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
		}
	\end{minipage}
	
	\begin{minipage}[t][10cm][t]{\textwidth}	
		\only<2->{
			\vspace*{-1.5cm}
			\begin{figure}[h]
				\begin{center}
					\begin{tikzpicture}[scale=0.42,transform shape]	
					\path (p4.south)+(0.0,-1.5) \ioitem{6}{5. Connected components};
					\path (p6.south)+(-5.5,-1.4) \blockitem{7}{7. Allele \\combinations};
					\path (p6.south)+(0.0,-1.4) \blockitem{8}{6. Candidate \\alleles};			
					\path (p7.south)+(0.0,-3.75) \blockitem{9}{8. Allele fractions};
					\path (p8.south)+(0.0,-1.5)	\ioitem{10}{9. Likelihood of alleles given one read};
					\path (p10.south)+(0.0,-1.5) \ioitem{12}{10. Likelihood of allele fractions given one read};
					\path (p12.south)+(0.0,-1.5) \ioitem{14}{11. Likelihood of allele fractions given all reads};
					\path (p14.south)+(0.0,-1.5) \ioitem{15}{12. Maximum likelihood allele fractions};
					\path (p15.south)+(0.0,-1.5) \ioitem{16}{15. Likelihood \\of an allele given another allele};			
					% Pfeile
					\path [line] (p6.south) -- node [above] {} (p8);
					\path [line] (p8.south) -- node [above] {} (p10) ;	
					\path [line] (p10.south) -- node [above] {} (p12) ;	
					\path [line] (p12.south) -- node [above] {} (p14) ;		
					\path [line] (p14.south) -- node [above, midway] {} (p15);
					\path [line] (p15.south) -- node [above] {} (p16) ;   
					
					\visible<3->{\path (p8.east)+(+4.4, 0.0) node (ur1)[ur] {\color{black}\lstinline|get_candidate_alleles()|};}
					\visible<4->{\path (p7.east)+(-1.92,2.2) node (ur2)[ur] {\color{black}\lstinline|get_max_parsimony_n_alleles()|};}
					\visible<5->{\path (p9.east)+(-8.2,0.0) node (ur3)[ur] {\color{black}\lstinline|get_candidate_vafs()|};}
					
					\path [dashedline] (p8.west) -- node [left] {} (p7);
					\path [dashedline] (p7.south) -- node [above] {} (p9) ;
					\path [dashedline] (p9.east) -- node [left] {} (p12.west);
					
					\visible<3->{\draw [funtool] (p8.east) -- (ur1);}
					\visible<4->{\draw [funtool] (p7.north) -- (ur2);}
					\visible<5->{\draw [funtool] (p9.west) -- (ur3);}
					\end{tikzpicture}
				\end{center}
			\end{figure}
		}
	\end{minipage}
\end{frame}

%%Folie 25
\section{Model und Implementierung}
\subsection{Laufzeit - Allele-Fractions}
\begin{frame}
	\frametitle{Laufzeit - Allele-Fractions}
		\only<1->{
		\begin{minipage}[t][2cm][t]{\textwidth}	
			\centering
			\scalebox{0.6}{
				\smartdiagramset{sequence item height=2.5cm,
					uniform color list=gray!60 for 5 items, border color=black}
				\only<1->{\smartdiagramset{set color
						list={blue!20,blue!20,red!60,blue!20,blue!20}}}
				\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
			}
	\end{minipage}}
	\only<1->{
		\begin{minipage}[t][10cm][t]{\textwidth}	
			\begin{itemize}
				\item \textbf{\lstinline|get_candidate_alleles()|}: $ O(|V_{C_{i}}|) $
				\vspace*{0.3cm}				
				\item \textbf{\lstinline|get_max_parsimony_n_alleles()|}: $ O(1) $
				\vspace*{0.3cm}
				\item \textbf{\lstinline|get_candidate_vafs()|}: 
					\begin{itemize}
						\item[] Kombinationen mit Wiederholung: $ O(\binom{n + k - 1}{k}) \in  O(e^n) $
						\item[] Allele-Fractions bilden: $O(n)$
					\end{itemize}
				\item[] $\Rightarrow$ gesamt: $ O(n\, \cdotp e^n)$
			\end{itemize}
	\end{minipage}}	
\end{frame}


%%Folie 26
\section{Model und Implementierung}
\subsection{Model - Likelihood der Allele-Fractions}
\begin{frame}
	\frametitle{Model - Likelihood der Allele-Fractions}
	\only<1->{
		\begin{minipage}[t][2cm][t]{\textwidth}	
			\centering
			\scalebox{0.6}{
				\smartdiagramset{sequence item height=2.5cm,
					uniform color list=gray!60 for 5 items, border color=black}
				\only<1->{\smartdiagramset{set color
						list={blue!20,blue!20,red!60,blue!20,blue!20}}}
				\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
			}
	\end{minipage}}
	\only<1->{
		\begin{minipage}[t][10cm][t]{\textwidth}	
		\only<1->{
		\setbeamercolor{block title}{bg=teal!60, fg=white}
		\setbeamercolor{block body}{bg=teal!25, fg=black}
		}
		\only<1-2>{
			Für \textbf{jeden Read} mit der Sequenz $s_{r}$ wird die Wahrscheinlichkeit errechnet, dass er aus einem bestimmten Allel $a_{i}$ allein durch Sequenzierfehler $\epsilon$ hervorgegangen ist:
			\only<2>{
			\begin{center}
				\begin{minipage}{10cm}
					\begin{varblock}{Allel-Likelihood gegeben ein Read}
						\centering
						$Pr(T=s_{r} \, | \, S=a_{i}, \epsilon) = pairHMM_{\epsilon,q_{r}}(a_{i}, s_{r})$
					\end{varblock}	
				\end{minipage}
			\end{center}}
			}
		\only<3-4>{
			Berechnung der Wahrscheinlichkeit, einen bestimmten Read $s_{r}$ anhand einer gegebenen \textbf{Allele-Fraction} $\Theta_{i} = (\theta_{1},\dots,\theta_{n}) \in [0,1]^{n}$ zu beobachten:
			\only<4>{
			\begin{center}
				\begin{minipage}{11cm}
					\begin{varblock}{Likelihood einer Allele-Fraction gegeben ein Read}
						\centering
						$Pr(s_{r} \, | \, \Theta=\theta_{1},\dots,\theta_{n}) = \sum_{i=1}^{n}\theta_{i} \, \cdotp Pr(T=s_{r} \, | \, S=a_{i}, \epsilon)$
					\end{varblock}						
				\end{minipage}
			\end{center}
			\hspace*{9.7cm}{\tiny (es gilt $n=n_{cand}$)}
			}
		}		
		\only<5-8>{		
			Bestimmung der resultierende Likelihood einer Allele-Fraction in Zusammenschau mit \textbf{allen Reads} $D = (s_{1}, \dots, s_{m}) \in \{A,C, G, T\}^{k^m}$:
			\only<6-8>{
				\begin{center}
					\begin{minipage}{12cm}
						\begin{varblock}{Likelihood einer Allele-Fraction gegeben alle Reads}
							\centering
							$L(\Theta=\theta_{1},\dots,\theta_{n} \, | \, D) = Pr(D \, | \, \Theta) = \prod_{r=1}^{m}Pr (s_{r} \, | \, \Theta)$
						\end{varblock}
					\end{minipage}
				\end{center}
			\only<7-8>{$\Rightarrow$ $L$ ist eine mögliche Loci-Verteilung, die durch die gegebene Allele-\\\hspace*{0.5cm}Fraction abgebildet wird\\}
			\only<8>{$\Rightarrow$ die Unsicherheit bei der Zuordnung der Reads wird durch die \\\hspace*{0.5cm}relativen Häufigkeiten in der Allele-Fraction abgebildet und an die\\\hspace*{0.5cm}spätere Loci-Zuordnung  weitergereicht\\}			
			}
		}
		\only<9>{
			\vspace*{-0.5cm}
			\begin{center}
				\begin{minipage}{10cm}
					\begin{varblock}{Allel-Likelihood gegeben ein Read}
						\centering
						$Pr(T=s_{r} \, | \, S=a_{i}, \epsilon) = pairHMM_{\epsilon,q_{r}}(a_{i}, s_{r})$
					\end{varblock}	
				\end{minipage}
			\end{center}
			
			\begin{center}
				\begin{minipage}{11cm}
					\begin{varblock}{Likelihood einer Allele-Fraction gegeben ein Read}
						\centering
						$Pr(s_{r} \, | \, \Theta=\theta_{1},\dots,\theta_{n}) = \sum_{i=1}^{n}\theta_{i} \, \cdotp Pr(T=s_{r} \, | \, S=a_{i}, \epsilon)$
					\end{varblock}						
				\end{minipage}
			\end{center}
			
			\begin{center}
				\begin{minipage}{12cm}
					\begin{varblock}{Likelihood einer Allele-Fraction gegeben alle Reads}
						\centering
						$L(\Theta=\theta_{1},\dots,\theta_{n} \, | \, D= s_{1}, \dots, s_{m}) = Pr(D \, | \, \Theta) = \prod_{r=1}^{m}Pr (s_{r} \, | \, \Theta)$
					\end{varblock}
				\end{minipage}
			\end{center}
		$\Rightarrow$ für die Allele-Fraction mit maximaler Likelihood erfolgt die \\\hspace*{0.5cm}Loci-Zuordnung
		}
	\end{minipage}}
\end{frame}		

%%Folie 27
%%Likelihood der Allele-Fractions
\section{Model und Implementierung}
\subsection{Implementierung - Allele likelihood}
\begin{frame}
	\frametitle{Implementierung - Likelihood der Allele-Fractions}
	\only<1-3,6-7,9->{
	\begin{minipage}[t][2.8cm][t]{\textwidth}	
		\centering
		\scalebox{0.6}{
			\smartdiagramset{sequence item height=2.5cm,
				uniform color list=blue!20 for 5 items}
			\only<1->{\smartdiagramset{set color
					list={blue!20,blue!20,red!60,blue!20,blue!20}}}
			\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
		}
	\end{minipage}}
	
	\begin{minipage}[t][10cm][t]{\textwidth}
		\vspace*{-1.5cm}	
		\only<2-3,6-7,9->{
			\begin{figure}[h]
				\begin{center}
					\begin{tikzpicture}[scale=0.42,transform shape]	
					\path (p4.south)+(0.0,-1.5) \ioitem{6}{5. Connected components};
					\path (p6.south)+(-5.5,-1.4) \ioitem{7}{7. Allele \\combinations};
					\path (p6.south)+(0.0,-1.4) \ioitem{8}{6. Candidate \\alleles};			
					\path (p7.south)+(0.0,-3.75) \ioitem{9}{8. Allele fractions};
					\path (p8.south)+(0.0,-1.5)	\blockitem{10}{9. Likelihood of alleles given one read};
					\path (p10.south)+(0.0,-1.5) \blockitem{12}{10. Likelihood of allele fractions given one read};
					\path (p12.south)+(0.0,-1.5) \blockitem{14}{11. Likelihood of allele fractions given all reads};
					\path (p14.south)+(0.0,-1.5) \blockitem{15}{12. Maximum likelihood allele fractions};
					\path (p15.south)+(0.0,-1.5) \ioitem{16}{15. Likelihood \\of an allele given another allele};
					\visible<3->{\path (p10.east)+(+4.1,0.0) node (ur1)[ur] {\color{black}\lstinline|get_allele_likelihood_read()|};}
					\visible<7->{\path (ur1.east)+(-3.0,2.1) node (ur2)[ur] {\color{black}\lstinline|get_alignment_likelihood()|};}
					\visible<10->{\path (p12.east)+(8.0-4,0) node (ur3)[ur] {\color{black}\lstinline|calc_vafs_likelihood_read()|};}
					\visible<11->{\path (p14.east)+(9.5-6,0) node (ur4)[ur] {\color{black}\lstinline|calc_vafs_likelihood()|};}
					
					% Pfeile
					\path [line] (p6.south) -- node [above] {} (p8);
					\path [line] (p8.south) -- node [above] {} (p10) ;	
					\path [line] (p10.south) -- node [above] {} (p12) ;	
					\path [line] (p12.south) -- node [above] {} (p14) ;		
					\path [line] (p14.south) -- node [above, midway] {} (p15);
					\path [line] (p15.south) -- node [above] {} (p16) ;   
					
					\path [dashedline] (p8.west) -- node [left] {} (p7);
					\path [dashedline] (p7.south) -- node [above] {} (p9) ;
					\path [dashedline] (p9.east) -- node [left] {} (p12.west);
					
					\visible<3->{\draw [funtool] (p10.east) -- (ur1);}
					\visible<7->{\draw [dashedline] (ur2.south) -- (ur1.north);}
					\visible<10->{\draw [funtool] (p12.east) -- (ur3);}
					\visible<11->{\draw [funtool] (p14.east) -- (ur4);}
					\end{tikzpicture}
				\end{center}
			\end{figure}
		}
	 	\only<4-5>{		 
	 		\vspace*{0.6cm}   
		    \begin{algorithm}[H]
		    	\footnotesize
		    	\begin{algorithmic}[]	
		    		\Function{get\_allele\_likelihood\_read}{$ C_{k} $, $ r_{i} $, $ s_{a_{j}} $, $ dict $}
		    		\State $ idx_{r_{i}} \gets r_{i}[name]$
		    		\State $ qual \gets r_{i}[q\_values] $
		    		\State $ \epsilon \gets C_{k}[\epsilon_{ins}] \cup C_{k}[\epsilon_{del}] $
		    		\If{$\exists (idx_{r_{i}}, s_{a_{i}}): ((idx_{r_{i}}, s_{a_{i}}), L_{r_{i}, a_{i}}) \in dict$}
		    		\State \Return $ L_{r_{i}, a_{i}} $
		    		\EndIf		
		    		\only<4>{\State $ out\_neighbors \gets get\_out\_neighbors(r_{i})$
		    		\For {$out\_neighbor \in out\_neighbors $}
		    		\If{$ s_{a_{j}} = out\_neighbor[sequence] $}
		    		\State $ cig \gets edge(r_{i}, out\_neighbor)[cigar\_tuples]$		
		    		\State $ rev \gets False $
		    		\State $ L_{r_{i}, a_{i}} \gets get\_alignment\_likelihood(\epsilon,\, cig,\, qual,\, rev)$		    		
		    		\State $ dict \gets dict \, \cup ((r_{i}, out\_neighbor[sequence]), L_{r_{i}, a_{i}})  $
		    		\State \Return $L_{r_{i}, a_{i}}$   
		    		\EndIf
		    		\EndFor
	    		    \State \textbf{\color{blue}$\Rightarrow$ check in\_neighbors}}
	    			\only<5>{
	    			\State \textbf{\color{blue}$\Rightarrow$ check out\_neighbors}		
		    		\State $ in\_neighbors \gets get\_in\_neighbors(r_{i})$		
		    		\For {$in\_neighbor \in in\_neighbors $}
		    		\If{$ s_{a_{j}} =  in\_neighbor[sequence] $}		
		    		\State $ cig \gets edge(in\_neighbor, r_{i})[cigar\_tuples]$		
		    		\State $ rev \gets True $
		    		\State $ L_{r_{i}, a_{i}} \gets get\_alignment\_likelihood(\epsilon,\, cig,\, qual,\, rev)$
		    		\State $ dict \gets dict \, \cup ((r_{i}, in\_neighbor[sequence]), L_{r_{i}, a_{i}})  $
		    		\State \Return $L_{r_{i}, a_{i}}$  
		    		\EndIf		
		    		\EndFor}		
		    		\State \Return 0
		    		\EndFunction
		    	\end{algorithmic}
		    \end{algorithm}
 		}
 		\only<8>{		 
 			\vspace*{1.1cm}  
 			\begin{algorithm}[H]
 				\tiny
 				\begin{algorithmic}[]	
 					\Function{get\_alignment\_likelihood}{$ \epsilon_{ins} $, $ \epsilon_{del} $, $ cigar\_tuples $, $ q_{query} $, reverse}
 					\State $ likelihood \gets 1.0 $, $ index \gets 0 $, $ p_{query} \gets [\;] $
 					\For{$ q_{i} \in q_{query} $}
 					\State $p_{query} \gets p_{query}\, \cup \, (10^{\frac{-q_{i}}{10}}) $
 					\EndFor			
 					\If {$reverse$}
 					\State swap values of $ \epsilon_{ins} $ and $ \epsilon_{del} $
 					\EndIf
 					\ForAll {$ (operation, length) \in cigar\_tuples $}
 					\While{$ index < (index + length) $}		
 					\If {$operation \in match $}		
 					\State $ likelihood\, \gets likelihood \,\cdotp (1-p_{query}[index]) $
 					\EndIf
 					\If {$operation \in substitution $}
 					\State $ likelihood\, \gets likelihood \,\cdotp \frac{1}{3} \,\cdotp p_{query}[index] $
 					\EndIf
 					\If {$operation \in insertion $}
 					\State $ likelihood\, \gets likelihood \,\cdotp \epsilon_{ins}$
 					\EndIf
 					\If {$operation \in deletion $}
 					\State $ likelihood\, \gets likelihood \,\cdotp \epsilon_{del} $
 					\EndIf
 					\State $index \gets index + 1 $
 					\EndWhile
 					\EndFor
 					\State \Return $likelihood$
 					\EndFunction		
 				\end{algorithmic}
 			\end{algorithm}
 		}
	\end{minipage}
\end{frame}

%%Folie 28
\section{Model und Implementierung}
\subsection{Laufzeit - Likelihood der Allele-Fractions}
\begin{frame}
	\frametitle{Laufzeit - Likelihood der Allele-Fractions}
		\only<1->{
		\begin{minipage}[t][2cm][t]{\textwidth}	
			\centering
			\scalebox{0.6}{
				\smartdiagramset{sequence item height=2.5cm,
					uniform color list=gray!60 for 5 items, border color=black}
				\only<1->{\smartdiagramset{set color
						list={blue!20,blue!20,red!60,blue!20,blue!20}}}
				\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
			}
	\end{minipage}}
	\only<1->{
		\begin{minipage}[t][10cm][t]{\textwidth}	
			\begin{itemize}
				\item \textbf{\lstinline|get_allele_likelihood_read()|}:
					\begin{itemize}
						\item[] Eintrag existiert im Dictionary: $ O(n \,\cdotp |V_{C_{i}}|) $
						\item[] Likelihood muss berechnet werden: $ O(n \,\cdotp l \,\cdotp |V_{C_{i}}|^2)$
					\end{itemize}
				\vspace*{0.3cm}	
				\item \textbf{\lstinline|get_alignment_likelihood()|}: $O(l)$
				\vspace*{0.3cm}	
				\item \textbf{\lstinline|calc_vafs_likelihood()|}: $ O(|V_{C_{i}}|) $
				\vspace*{0.3cm}	
				\item \textbf{\lstinline|calc_vafs_likelihood_read()|}: $ O(n) $ 
				\vspace*{0.3cm}	
				\item Maximumsbestimmung: $ O(e^n) $ 
			\end{itemize}
	\end{minipage}}	
\end{frame}

%%Folie 29
\section{Model und Implementierung}
\subsection{Model - Loci-Kombinationen}
\begin{frame}
	\frametitle{Model - Loci-Kombinationen}
	\only<1->{
		\begin{minipage}[t][2cm][t]{\textwidth}	
			\centering
			\scalebox{0.6}{
				\smartdiagramset{sequence item height=2.5cm,
					uniform color list=gray!60 for 5 items, border color=black}
				\only<1->{\smartdiagramset{set color
						list={blue!20,blue!20,blue!20,red!60,blue!20}}}
				\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
			}
	\end{minipage}}
\only<1->{
	\begin{minipage}[t][10cm][t]{\textwidth}			
		\only<2-4>{
			\begin{itemize}
				\item Die Allel-Fraction mit maximaler Likelihood soll möglichen genomischen Loci zugeordnet werden
				\visible<3-4>{\item in Abhängigkeit von Ploidie und Anzahl der Kandidatenallele können auch mehrere Loci in einer Zusammenhangskomponente vorkommen
				\visible<4>{\item für alle Allelkombinationen müssen die möglichen Loci-Kombinationen der in ihnen enthaltenen Kandidatenallele gebildet werden}}
			\end{itemize}
		}

		\only<5-14>{
			\textbf{$\Rightarrow$ Beispiel:} \color{blue}$ ploidy = 2, n_{cand} = 3, n_{alleles} = 4 $: \\
			\\
			\only<6>{		
				\hspace*{0.5cm}\color{black}\textbf{Kombinationen der Allele}:
				\begin{itemize}
					\item[] \color{black}{[(0, 0, 0, 0), (0, 0, 0, 1), (0, 0, 0, 2), (0, 0, 1, 1), (0, 0, 1, 2), \\$ \; $(0, 0, 2, 2), (0, 1, 1, 1), (0, 1, 1, 2), (0, 1, 2, 2), (0, 2, 2, 2), \\$ \; $(1, 1, 1, 1), (1, 1, 1, 2), (1, 1, 2, 2), (1, 2, 2, 2), (2, 2, 2, 2)]}\\
				\end{itemize}												
			}
			\only<7>{
				\hspace*{0.5cm}\color{black}\textbf{Permutationen der Allele}:
					\begin{itemize}
						\item[] {\footnotesize \color{black}(1, 2, 1, 1), (2, 1, 0, 0), (2, 1, 1, 1), (0, 1, 2, 1), (0, 1, 1, 2), (0, 1, 0, 0),\\ (2, 2, 1, 0), (0, 2, 2, 1), (2, 2, 0, 1), (1, 0, 2, 2), (0, 2, 0, 1), (2, 0, 0, 1), \\(1, 0, 1, 0), (0, 2, 1, 2), (0, 0, 2, 0), (2, 2, 2, 1), (1, 1, 0, 1), (2, 0, 1, 1), \\(2, 0, 2, 0), (0, 0, 2, 2), (1, 1, 2, 0), (1, 2, 1, 0), (2, 0, 2, 2), (2, 1, 1, 0), \\(2, 1, 0, 2), (1, 2, 0, 1), (0, 1, 2, 0), (1, 2, 1, 2), (1, 2, 2, 1), (0, 1, 1, 1), \\(1, 1, 1, 0), (0, 0, 0, 0), (2, 1, 1, 2), (2, 1, 2, 1), (1, 0, 0, 1), (0, 1, 0, 2), \\(2, 2, 1, 2), (0, 2, 2, 0), (1, 0, 2, 1), (2, 0, 0, 0), (0, 2, 1, 1), (1, 1, 1, 2), \\(0, 0, 0, 2), (0, 0, 1, 1), (1, 0, 1, 2), (2, 0, 0, 2), (0, 0, 2, 1), (1, 1, 2, 2), \\(2, 1, 0, 1), (1, 2, 0, 0), (0, 1, 2, 2), (1, 2, 2, 0), (0, 1, 1, 0), (2, 2, 0, 0), \\(0, 2, 0, 0), (2, 1, 2, 0), (1, 0, 0, 0), (1, 2, 0, 2), (0, 1, 0, 1), (2, 2, 1, 1), \\(2, 2, 2, 0), (1, 1, 0, 0), (1, 0, 2, 0), (0, 2, 2, 2), (1, 2, 2, 2), (2, 2, 0, 2),...\\}
					\end{itemize}	}
			\only<8>{
				\hspace*{0.5cm}\color{black}\textbf{Mögliche Loci-Kombinationen}:
					\begin{itemize}
						\item[] \color{black}
						((0, 0), (0, 2)), ((1, 1), (1, 1)), ((0, 2), (0, 2)), ((1, 1), (2, 2)), \\
						((0, 1), (0, 2)), ((1, 1), (1, 2)), ((1, 2), (2, 2)), ((1, 2), (1, 2)),
						\\ 
						((0, 0), (1, 1)), ((0, 0), (2, 2)), ((0, 2), (1, 1)), ((0, 1), (1, 1)), 
						\\
						((0, 0), (0, 0)), ((0, 2), (2, 2)), ((0, 0), (1, 2)), ((0, 1), (2, 2)), 
						\\
						((2, 2), (2, 2)), ((0, 0), (0, 1)), ((0, 2), (1, 2)), ((0, 1), (1, 2)), 
						\\
						((0, 1), (0, 1)) \\
					\end{itemize}}
			\only<9-14>{		
				\hspace*{0.5cm}\color{black}\textbf{Kombinationen der Allele}:
				\begin{itemize}
					\item[] \color{black}{\footnotesize {[... (0, 1, 1, 2), ...]}\\}
				\end{itemize}
			\hspace*{0.5cm}\color{black}\textbf{Permutationen der Allele}:
				\begin{itemize}
					\item[] \color{black}{\footnotesize(1, 0, 1, 2), (0, 1, 1, 2), (0, 1, 2, 1), (1, 0, 2, 1), (2, 1, 1, 0), (1, 2, 0, 1), \\(2, 1, 0, 1), (2, 1, 0, 1), (2, 1, 0, 1), (1, 2, 1, 0), (1, 1, 2, 0), (1, 1, 0, 2), \\(2, 0, 1, 1), (0, 2, 1, 1), ... \\}	
				\end{itemize}	
			\only<9>{
			\hspace*{0.5cm}\color{black}\textbf{Mögliche Loci-Kombinationen}:
				\begin{itemize}
					\item[] \color{black}
					{\footnotesize((1, 0), (1, 2)), ((0, 1), (1, 2)), ((0, 1), (2, 1)), ((1, 0), (2, 1)), ((2, 1), (1, 0)), ((1, 2), (0, 1)), ((2, 1), (0, 1)), ((2, 1), (0, 1)), ((2, 1), (0, 1)), ((1, 2), (1, 0)), ((1, 1), (2, 0)), ((1, 1), (0, 2)), ((2, 0), (1, 1)), ((0, 2), (1, 1)), ... \\}
				\end{itemize}}	
			\only<10>{
				\hspace*{0.5cm}\color{black}\textbf{Mögliche Loci-Kombinationen}:
				\begin{itemize}
					\item[] \color{black}
					{\footnotesize  \color{blue}((1, 0), (1, 2)), ((0, 1), (1, 2)), ((0, 1), (2, 1)), ((1, 0), (2, 1)), \color{darkgreen}((2, 1), (1, 0)), ((1, 2), (0, 1)), ((2, 1), (0, 1)), ((2, 1), (0, 1)), ((2, 1), (0, 1)), ((1, 2), (1, 0)),  \color{lila}((1, 1), (2, 0)), ((1, 1), (0, 2)), \color{red}((2, 0), (1, 1)), ((0, 2), (1, 1))\color{black}, ... \\}
				\end{itemize}	
			}		
			\only<11>{
				\hspace*{0.5cm}\color{black}\textbf{Mögliche Loci-Kombinationen}:
				\begin{itemize}
					\item[] \color{black}
					{\footnotesize  \color{blue}((0, 1), (1, 2)), \color{darkgreen}((1, 2), (0, 1)), \color{lila}((1, 1), (0, 2)), \color{red}((0, 2), (1, 1))\color{black}, ... \\}
				\end{itemize}	
			}					
			\only<12>{
			\hspace*{0.5cm}\color{black}\textbf{Mögliche Loci-Kombinationen}:
				\begin{itemize}
					\item[] \color{black}
					{\footnotesize  ((0, 1), (1, 2)), ((1, 2), (0, 1)), ((1, 1), (0, 2)), ((0, 2), (1, 1)), ... \\}
				\end{itemize}	
			}		
			\only<13>{
				\hspace*{0.5cm}\color{black}\textbf{Mögliche Loci-Kombinationen}:
				\begin{itemize}
					\item[] \color{black}
					{\footnotesize  \color{blue}((0, 1), (1, 2)), ((1, 2), (0, 1)), \color{red}((1, 1), (0, 2)), ((0, 2), (1, 1))\color{black}, ... \\}
				\end{itemize}	
			}	
			\only<14>{
				\hspace*{0.5cm}\color{black}\textbf{Mögliche Loci-Kombinationen}:
				\begin{itemize}
					\item[] \color{black}
					{\footnotesize  \color{blue}((0, 1), (1, 2)), \color{red}((1, 1), (0, 2))\color{black}, ... \\}
				\end{itemize}	
			}		
			}
		}	
	\end{minipage}}
\end{frame}				

%%Folie 30
%%Loci-Kombinationen
\section{Model und Implementierung}
\subsection{Implementierung - Loci-Kombinationen}
\begin{frame}
	\frametitle{Implementierung - Loci-Kombinationen}
	\begin{minipage}[t][2.5cm][t]{\textwidth}	
		\centering
		\scalebox{0.6}{
			\smartdiagramset{sequence item height=2.5cm,
				uniform color list=blue!20 for 5 items}
			\only<1->{\smartdiagramset{set color
					list={blue!20,blue!20,blue!20,red!60,blue!20}}}
			\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
		}
	\end{minipage}
	
	\begin{minipage}[t][10cm][t]{\textwidth}	
		\only<2->{
			\vspace*{-2.0cm}
			\begin{figure}[h]
				\begin{center}
					\begin{tikzpicture}[scale=0.50,transform shape]
					\path (p9.south)+(-1.0,-6.35) \ioitem{11}{14. Indicator constraint};
					\path (p11.south)+(0.0,-1.5) \blockitem{13}{13. Loci \\combinations};
					\path (p14.south)+(0.0,-1.5) \ioitem{15}{12. Maximum likelihood allele fractions};
					\path (p15.south)+(0.0,-2.0) \ioitem{16}{15. Likelihood \\of an allele given another allele};
					\path (p16.south)+(0.0,-1.8) \ioitem{17}{16. Likelihood of loci given alleles and fractions}; 
					\path (p17.south)+(0.0,-1.3) \ioitem{18}{17. Maximum likelihood loci};
					\path (p18.south)+(0.0,-1.7) \ioitem{19}{18. VCF \\ \includegraphics[width=0.9cm]{pictures/list_icon_2.png}\hspace{0.1cm}\includegraphics[width=0.9cm]{pictures/list_icon_2.png}\hspace{0.1cm}\includegraphics[width=0.9cm]{pictures/list_icon_2.png}};
					\visible<3->{\path (p13.west)+(-4.5, 0.0) node (ur1)[ur] {\color{black}\lstinline|get_candidate_loci()|};}
					% Pfeile
					\path [line] (p15.south) -- node [above] {} (p16) ;     
					\path [line] (p16.south) -- node [above] {} (p17) ;
					\path [line] (p17.south) -- node [above] {} (p18) ;
					\path [line] (p18.south) -- node [above] {} (p19) ;		
					
					\path [dashedline] (p11.east) -- node [left] {} (p16.west);
					\path [dashedline] (p13.north) -- node [left] {} (p11.south); 
					
					\visible<3->{\draw [funtool] (p13.west) -- (ur1.east);}
					\end{tikzpicture}
				\end{center}
			\end{figure}
		}
	\end{minipage}
\end{frame}

%%Folie 31
\section{Model und Implementierung}
\subsection{Laufzeit - Loci-Kombinationen}
\begin{frame}
	\frametitle{Laufzeit - Loci-Kombinationen}
		\only<1->{
		\begin{minipage}[t][2cm][t]{\textwidth}	
			\centering
			\scalebox{0.6}{
				\smartdiagramset{sequence item height=2.5cm,
					uniform color list=gray!60 for 5 items, border color=black}
				\only<1->{\smartdiagramset{set color
						list={blue!20,blue!20,blue!20,red!60,blue!20}}}
				\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
			}
	\end{minipage}}
	\only<1->{
		\begin{minipage}[t][10cm][t]{\textwidth}	
			\begin{itemize}
				\item eigentlich müssen alle Permutationen über allen Allelkombinationen gebildet werden
				\vspace*{0.3cm}	
				\item wegen Indikatorfunktion genügt es die Permutationen nur über der Allele-Fraction mit maximaler Likelihood zu bilden
				\vspace*{0.3cm}	
				\item Laufzeit von \textbf{\lstinline|get_candidate_loci()|} beträgt dann $O(n!\, \cdotp \log n) $ 			
			\end{itemize}
	\end{minipage}}	
\end{frame}

%%Folie 32
\section{Model und Implementierung}
\subsection{Model - Zuordnung der Loci}
\begin{frame}
	\frametitle{Model - Zuordnung der Loci}
	\only<1->{
		\begin{minipage}[t][2cm][t]{\textwidth}	
			\centering
			\scalebox{0.6}{
				\smartdiagramset{sequence item height=2.5cm,
					uniform color list=gray!60 for 5 items, border color=black}
				\only<1->{\smartdiagramset{set color
						list={blue!20,blue!20,blue!20,red!60,blue!20}}}
				\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
			}
	\end{minipage}}
	\only<1->{
		\begin{minipage}[t][10cm][t]{\textwidth}
		\only<1->{
			\setbeamercolor{block title}{bg=teal!60, fg=white}
			\setbeamercolor{block body}{bg=teal!25, fg=black}
		}
		\only<2-4>{
			Prüfung jeder Loci-Kombination $L \in \{l_{j} \in \mathds{N}_{\leq n}^\phi \, | \, j=1, \dots, g\}$, ob sie die ermittelte wahrscheinlichste Häufigkeitsverteilung der Kandidatenallele erfüllen kann:
			\only<3-4>{
				\begin{center}
					\begin{minipage}{8cm}
						\begin{varblock}{Indikatorfunktion $z_{L} \in [0,1]$}
							\centering
							$z_{L}=\prod_{i=1}^{n}1_{\sum_{j=1}^{g}\sum_{k=1}^{\phi}1_{l_{j,k}=i} = \theta_{i} \, \cdotp g \, \cdotp \phi}$
						\end{varblock}	
					\end{minipage}
				\end{center}}
		\only<4>{\vspace*{0.2cm}
		$\Rightarrow$ $z_{L}=1$, wenn die absolute Häufigkeit der einzelnen Kandidatenallele in einer Loci-Kombination, der Anzahl dieser Allele in der Allele-Fraction mit maximaler Likelihood entspricht}
		}
		\only<5-7>{
			Bestimmung der Wahrscheinlichkeit wie die einzelnen Allele der Maximum-Likelihood-Allele-Fraction hinsichtlich der Heterozygotiewahrscheinlichkeiten $\eta$ miteinander in Beziehung stehen:
			\only<6-7>{
				\begin{center}
					\begin{minipage}{10.5cm}
						\begin{varblock}{Likelihood des paarweisen Vergleichs zweier Allele}
							\centering
							$Pr(T=a_{l_{j,2}} \, , \, S=a_{l_{j,1}}, \eta) = pairHMM_{\eta}(a_{l_{j,1}}, a_{l_{j,2}})$
						\end{varblock}						
					\end{minipage}
				\end{center}
			}
		\only<7>{\vspace*{0.2cm}
			$\Rightarrow$ Wahrscheinlichkeit, dass zwei Allele $a_{l_{j,1}}$ und $a_{l_{j,2}}$ vom gleichen Locus $l_{j}$ stammen}
		}		
		\only<8-10>{		
			Bestimmung der Gesamtlikelihood einer Loci-Kombination, dass die enthaltenen Allele $A$ bei gegebenen Heterozygotiewahrscheinlichkeiten in dieser Konstellation der Loci vorliegen:
			\only<9-10>{
				\begin{center}
					\begin{minipage}{13cm}
						\begin{varblock}{Likelihood einer Loci-Kombination}
							\centering
							$Pr(\Theta,A \, | \, L=\{l_{j}\, |\, j=1,\dots,g\})=z_{L} \, \cdotp \prod_{j=1}^{g}Pr(T=a_{l_{j,2}} \, , \, S=a_{l_{j,1}})$
						\end{varblock}
					\end{minipage}
				\end{center}
			}
			\only<10>{$\Rightarrow$ $L$ wird für jede Loci-Kombination durchgeführt, welche die Allele-Fraction mit maximaler Likelihood erklären kann\\	
			}
		}
		\only<11>{
			\vspace*{-0.5cm}
			\begin{center}
				\begin{minipage}{8cm}
					\begin{varblock}{Indikatorfunktion $z_{L} \in [0,1]$}
						\centering
						$z_{L}=\prod_{i=1}^{n}1_{\sum_{j=1}^{g}\sum_{k=1}^{\phi}1_{l_{j,k}=i} = \theta_{i} \, \cdotp g \, \cdotp \phi}$
					\end{varblock}	
				\end{minipage}
			\end{center}
		
			\begin{center}
				\vspace*{-0.25cm}
				\begin{minipage}{10.5cm}
					\begin{varblock}{Likelihood des paarweisen Vergleichs zweier Allele}
						\centering
						$Pr(T=a_{l_{j,2}} \, , \, S=a_{l_{j,1}}, \eta) = pairHMM_{\eta}(a_{l_{j,1}}, a_{l_{j,2}})$
					\end{varblock}						
				\end{minipage}
			\end{center}
			
			\begin{center}
				\vspace*{-0.25cm}
				\begin{minipage}{13cm}
					\begin{varblock}{Likelihood einer Loci-Kombination}
						\centering
						$Pr(\Theta,A \, | \, L=\{l_{j}\, |\, j=1,\dots,g\})=z_{L} \, \cdotp \prod_{j=1}^{g}Pr(T=a_{l_{j,2}} \, , \, S=a_{l_{j,1}})$
					\end{varblock}
				\end{minipage}
			\end{center}
		$\Rightarrow$ die Loci-Kombination mit maximaler Likelihood ist die wahrscheinlichste Loci-Zuordnung der Reads einer Zusammenhangskomponente
		}
	\end{minipage}}
\end{frame}	

%%Folie 33
%%Likelihood der Loci-Zuordnung
\section{Model und Implementierung}
\subsection{Implementerierung - Zuordnung der Loci}
\begin{frame}
	\frametitle{Implementerierung - Zuordnung der Loci}
	\only<1-5,7-8,10-11>{
	\begin{minipage}[t][2.5cm][t]{\textwidth}	
		\centering
		\scalebox{0.6}{
			\smartdiagramset{sequence item height=2.5cm,
				uniform color list=blue!20 for 5 items}
			\only<1->{\smartdiagramset{set color
					list={blue!20,blue!20,blue!20,red!60,blue!20}}}
			\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
		}
	\end{minipage}}
	
	\begin{minipage}[t][10cm][t]{\textwidth}	
		\only<2-5,7-8,10-11>{
			\vspace*{-2.0cm}
			\begin{figure}[h]
				\begin{center}
					\begin{tikzpicture}[scale=0.50,transform shape]
					\path (p9.south)+(-1.0,-6.35) \blockitem{11}{14. Indicator constraint};
					\path (p11.south)+(0.0,-1.5) \ioitem{13}{13. Loci \\combinations};
					\path (p14.south)+(0.0,-1.5) \ioitem{15}{12. Maximum likelihood allele fractions};
					\path (p15.south)+(0.0,-2.0) \blockitem{16}{15. Likelihood \\of an allele given another allele};
					\path (p16.south)+(0.0,-1.8) \blockitem{17}{16. Likelihood of loci given alleles and fractions}; 
					\path (p17.south)+(0.0,-1.3) \blockitem{18}{17. Maximum likelihood loci};
					\path (p18.south)+(0.0,-1.7) \ioitem{19}{18. VCF \\ \includegraphics[width=0.9cm]{pictures/list_icon_2.png}\hspace{0.1cm}\includegraphics[width=0.9cm]{pictures/list_icon_2.png}\hspace{0.1cm}\includegraphics[width=0.9cm]{pictures/list_icon_2.png}};
					
					% Pfeile
					\path [line] (p15.south) -- node [above] {} (p16) ;     
					\path [line] (p16.south) -- node [above] {} (p17) ;
					\path [line] (p17.south) -- node [above] {} (p18) ;
					\path [line] (p18.south) -- node [above] {} (p19) ;		
					
					\path [dashedline] (p11.east) -- node [left] {} (p16.west);
					\path [dashedline] (p13.north) -- node [left] {} (p11.south); 
					
					\visible<4->{\path (p11.north)+(0.0, 1.0) node (ur1)[ur] {\color{black}\lstinline|indicator_constraint()|};}
					\visible<3->{\path (p11.north)+(-0.0, 2.5) node (ur2)[ur] {\color{black}\lstinline|calc_loci_likelihoods()|};}
					\visible<5->{\path (p16.east)+(4.0, 0.0) node (ur3)[ur] {\color{black}\lstinline|get_heterozygosity()|};}
					\visible<8->{\path (ur3.north)+(0.0, 1.5) node (ur4)[ur] {\color{black}\lstinline|get_cigar_tuples()|};}
					\visible<11->{\path (p17.east)+(5.1, 0.0) node (ur5)[ur] {\color{black}\lstinline|get_allele_likelihood_alleles()|};}
					
					\visible<4->{\path [dashedline] (ur2.south) -- node [left] {} (ur1.north);}
					\visible<8->{\path [dashedline] (ur4.south) -- node [left] {} (ur3.north);}
					
					% Pfeile%
					\visible<4->{\draw [funtool] (p11.north) -- (ur1.south);}		
					\visible<5->{\draw [funtool] (p16.east) -- (ur3.west);}	
					\visible<11->{\draw [funtool] (p17.east) -- (ur5.west);}
					\end{tikzpicture}
				\end{center}
			\end{figure}
		}
	\only<6>{		 
		\vspace*{-0.6cm}   
		\begin{algorithm}[H]
			\scriptsize
			\begin{algorithmic}[]	
				\Function{get\_heterozygosity}{$\eta_{sub}$, $\eta_{ins}$, $\eta_{del}$, $ cigar\_tuples $, $ reverse $}
				\State $likelihood \gets 1.0$
				\If{reverse}
				\State swap values of $\eta_{ins}$ and $\eta_{del}$
				\EndIf
				\ForAll{$(operation, length) \in cigar\_tuples$}
				\If{$operation \in match$}
				\State $ likelihood \gets likelihood \, \cdotp (1 - (\eta_{sub}+\eta_{ins}+\eta_{del}))^{\;length} $
				\EndIf		    		    	
				\If{$operation \in substitution$}
				\State $likelihood \gets likelihood \, \cdotp (\eta_{sub})^{length}$
				\EndIf	
				\If{$operation \in insertion$}
				\State $likelihood \gets likelihood \, \cdotp (\eta_{ins})^{length}$
				\EndIf
				\If{$operation \in deletion$}
				\State $likelihood \gets likelihood \, \cdotp (\eta_{del})^{length}$
				\EndIf
				\EndFor
				\State \Return $ likelihood $
				\EndFunction
			\end{algorithmic}
		\end{algorithm}
	}
	\only<9>{		 
		\vspace*{-0.1cm}  
		\begin{algorithm}[H]
			\footnotesize
			\begin{algorithmic}[]	
				\Function{get\_cigar\_tuples}{$ C_{k} $, $ s_{query} $, $ s_{ref} $}
				\State $ R_{source} \gets \{v_{i} \in C_{k} \wedge i,k \in \mathds{N} \; |\; v_{i}[sequence]= s_{query} \}$
				\State $ R_{target} \gets \{w_{j} \in C_{k} \wedge j,k \in \mathds{N} \; |\; w_{j}[sequence]= s_{ref} \}$
				\For{$ v_{i} \in R_{source} $}
				\For{$ w_{j} \in R_{target} $}
				\If{$ (v_{i}, w_{j}) \in E_{k}$}
				\State \Return $ (\;E_{k}[(v_{i}, w_{j})][cigar\_tuples],\, False\;) $		    
				\EndIf
				\If{$ (w_{j}, v_{i}) \in E_{k}$}
				\State \Return $ (\;E_{k}[(w_{j}, v_{i})][cigar\_tuples],\, True\;) $		
				\EndIf
				\EndFor
				\EndFor
				\State \Return $ None $
				\EndFunction
			\end{algorithmic}
		\end{algorithm}
	}
    \only<12>{		 
    	\vspace*{-0.6cm}  
    	\begin{algorithm}[H]
    		\footnotesize
    		\begin{algorithmic}[]	
    				\Function{get\_allele\_likelihood\_alleles}{$ C_{k} $, $ S_{\,loc} $, $ dict_{\,loc} $}
    			\State $ likelihood \gets 1.0 $		
    			\For{$ (s_{a_{i}}, s_{a_{j}}) \in S_{\,loc} $}
    			\If{$\exists (s_{a_{i}}, s_{a_{j}}): ((s_{a_{i}}, s_{a_{j}}), L_{a_{i}, a_{j}}) \in dict_{\,loc}$}
    			\State $likelihood \gets likelihood + L_{a_{i}, a_{j}} $
    			\Else		    
    			\State $cigar \gets get\_cigar\_tuples(C_{k}, s_{a_{i}}, s_{a_{j}})$ 
    			\If{$cigar$ exists}
    			\State $cig \gets cigar\,[\,0\,]$
    			\State $rev \gets cigar\,[\,1\,]$
    			\State $ \eta_{rates} \gets C_{k}[\eta_{sub}] \cup C_{k}[\eta_{ins}] \cup C_{k}[\eta_{del}]$
    			\State $L_{a_{i}, a_{j}} \gets log(get\_heterozygosity(\eta_{rates}, cig, rev))$  
    			\State $ dict_{\,loc} \gets dict_{\,loc} \, \cup ((s_{a_{i}}, s_{a_{j}}),  L_{a_{i}, a_{j}})  $
    			\State $ likelihood \gets likelihood + L_{a_{i}, a_{j}}$    
    			\EndIf
    			\EndIf
    			\EndFor
    			\State \Return $ e^{\;likelihood} $
    			\EndFunction
    		\end{algorithmic}
    	\end{algorithm}
    }
	\end{minipage}
\end{frame}

%%Folie 34
\section{Model und Implementierung}
\subsection{Laufzeit - Zuordnung der Loci}
\begin{frame}
	\frametitle{Laufzeit - Zuordnung der Loci}
		\only<1->{
		\begin{minipage}[t][2cm][t]{\textwidth}	
			\centering
			\scalebox{0.6}{
				\smartdiagramset{sequence item height=2.5cm,
					uniform color list=gray!60 for 5 items, border color=black}
				\only<1->{\smartdiagramset{set color
						list={blue!20,blue!20,blue!20,red!60,blue!20}}}
				\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
			}
	\end{minipage}}
	\only<1->{
		\begin{minipage}[t][10cm][t]{\textwidth}	
			\begin{itemize}
				\item \textbf{\lstinline|calc_loci_likelihoods()|}: $O(n!)$
				\vspace*{0.1cm}	
				\item \textbf{\lstinline|indicator_constraint()|}: $ O(n) $
				\vspace*{0.1cm}	
				\item \textbf{\lstinline|get_cigar_tuples()|}: $O(|V_{C_{i}}|^3)$
				\vspace*{0.1cm}	
				\item \textbf{\lstinline|get_heterozygosity()|}: $O(l)$
				\vspace*{0.1cm}	
				\item \textbf{\lstinline|get_allele_likelihoods_allele()|}:
					\begin{itemize}
						\item[] Likelihood und CIGAR-Tuples müssen für $\binom{n}{2}$ Elemente ermittelt werden, Laufzeitfaktor: $O(\binom{n}{2}) \in O(n^2)$
						\vspace*{0.1cm}	
						\item[] Eintrag existiert im Dictionary für $n! - \binom{n}{2}$ Elemente, Laufzeitfaktor $O(n! - \binom{n}{2}) \in O(n! - n^2)$					
					\end{itemize}
				\vspace*{0.1cm}	
				\item Maximumsbestimmung: $O(n!)$
			\end{itemize}
	\end{minipage}}	
\end{frame}

%%Folie 35
\section{Model und Implementierung}
\subsection{Laufzeit - Gesamtlaufzeit}
\begin{frame}
	\frametitle{Laufzeit - Gesamtlaufzeit}
		\only<1->{
		\begin{minipage}[t][2cm][t]{\textwidth}	
			\centering
			\scalebox{0.6}{
				\smartdiagramset{sequence item height=2.5cm,
					uniform color list=gray!60 for 5 items, border color=black}
				\only<1->{\smartdiagramset{set color
						list={blue!20,blue!20,blue!20,blue!20,blue!20}}}
				\only<2->{\smartdiagramset{set color
						list={blue!20,red!60,blue!20,blue!20,blue!20}}}
				\only<3->{\smartdiagramset{set color
							list={blue!20,red!60,red!60,blue!20,blue!20}}}
				\only<4->{\smartdiagramset{set color
							list={blue!20,red!60,red!60,red!60,blue!20}}}
				\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
			}
	\end{minipage}}	
\vspace*{-0.2cm}
		\begin{minipage}[t][10cm][t]{\textwidth}
			\only<2->{	
			\begin{itemize}
				\item Graphkonstruktion: $O(|V| \, \cdotp (|V| + |E|))$
				\only<3->{\item Bestimmung der Allele-Fraction mit maximaler Likelihood: \[
					O( e^n\, \cdotp n\, \cdotp |V_{C_{i}}| + l\, \cdotp n^2\, \cdotp |V_{C_{i}}|^3)\]  }
				\only<4->{\item Bestimmung der wahrscheinlichsten Loci-Zuordnung:
				\[ O( l\, \cdotp n^3  \, \cdotp |V_{C_{i}}|^3 + n  \, \cdotp n!) \]}
			\end{itemize}
		\only<4->{$\Rightarrow$ \textbf{Gesamtlaufzeit}: \[O\left(\sum_{i=1}^{|C|} n_{C_{i}}  \, \cdotp n_{C_{i}} ! \right)\]}
		}
	\end{minipage}
\end{frame}


%%Folie 36
\section{Model und Implementierung}
\subsection{Model - VCF-Output}
\begin{frame}
	\frametitle{Model - Ausgabe im Variant Call Format}
	\only<1->{
		\begin{minipage}[t][2cm][t]{\textwidth}	
			\centering
			\scalebox{0.6}{
				\smartdiagramset{sequence item height=2.5cm,
					uniform color list=gray!60 for 5 items, border color=black}
				\only<1->{\smartdiagramset{set color
						list={blue!20,blue!20,blue!20,blue!20,red!60}}}
				\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
			}
	\end{minipage}}
	\only<1->{
		\begin{minipage}[t][10cm][t]{\textwidth}	
			\only<2->{
				enthält die Loci mit den Sequenzen ihrer Allele und ihrem Genotyp\\
				\\}
			\only<3>{
				\includegraphics[width =0.95\textwidth] {pictures/vcf.png}
			}
	\end{minipage}}
\end{frame}

%%Folie 37
%%Ausgabe als VCF-File
\section{Model und Implementierung}
\subsection{Implementierung - VCF-Output}
\begin{frame}
	\frametitle{Implementierung - Ausgabe im Variant Call Format}
	\begin{minipage}[t][3cm][t]{\textwidth}	
		\centering
		\scalebox{0.6}{
			\smartdiagramset{sequence item height=2.5cm,
				uniform color list=blue!20 for 5 items}
			\only<1->{\smartdiagramset{set color
					list={blue!20,blue!20,blue!20,blue!20,red!60}}}
			\smartdiagram[sequence diagram]{Preprocessing, Graph, Allele likelihood, Loci likelihood, Output VCF File}
		}
	\end{minipage}
	
	\begin{minipage}[t][10cm][t]{\textwidth}	
		\only<2->{
			\vspace*{-0.5cm}
			\begin{figure}[h]
				\begin{center}
					\begin{tikzpicture}[scale=0.64,transform shape]
					\path (p17.south)+(0.0,-1.3) \ioitem{18}{17. Maximum likelihood loci};
					\path (p18.south)+(0.0,-1.7) \blockitem{19}{18. VCF \\ \includegraphics[width=0.9cm]{pictures/list_icon_2.png}\hspace{0.1cm}\includegraphics[width=0.9cm]{pictures/list_icon_2.png}\hspace{0.1cm}\includegraphics[width=0.9cm]{pictures/list_icon_2.png}};
					\visible<3->{\path (p19.west)+(-4.1, 1.0) node (ur1)[ur] {\color{black}\lstinline|get_sorted_loci_alleles()|};}
					\visible<4->{\path (p19.west)+(-4.5, 0.0) node (ur2)[ur] {\color{black}\lstinline|get_alleles_matched_to_loci()|};}
					\visible<5->{\path (p19.west)+(-3.21, -1.0) node (ur3)[ur] {\color{black}\lstinline|get_gt_indices()|};}
					\visible<6->{\path (p19.west)+(-3.03, -2.0) node (ur4)[ur] {\color{black}\lstinline|get_genotype()|};}
					
					% Pfeile
					\path [line] (p18.south) -- node [above] {} (p19) ;		
					
					\visible<3->{\draw [funtool] (p19.west) -- (ur1.east);}
					\visible<4->{\draw [funtool] (p19.west) -- (ur2.east);}
					\visible<5->{\draw [funtool] (p19.west) -- (ur3.east);}
					\visible<6->{\draw [funtool] (p19.west) -- (ur4.east);}
					\end{tikzpicture}
				\end{center}
			\end{figure}
		}
	\end{minipage}
\end{frame}

%%Folie 38
\section{Evaluation an simulierten Daten}
\subsection{Konfiguration}
\begin{frame}
	\frametitle{Evaluation an simulierten Daten}
	\vspace*{0.5cm}
	\begin{table}[H]
		\begin{center}
			\begin{tabular}{lccc}
				\hline
				\multicolumn{4}{|c|}{\cellcolor{light-gray}\textbf{Konfigurierte Schwellenwerte}} \\ \hline \hline
				\multicolumn{1}{|c|}{\textbf{\begin{tabular}[c]{@{}c@{}}threshold max \\ edit distance\end{tabular}}} & \multicolumn{2}{c|}{\textbf{treshold-seq-noise}} & \multicolumn{1}{c|}{\textbf{treshold-cluster-size}} \\ \hline \hline
				\multicolumn{1}{|l|}{} & \multicolumn{1}{c|}{small-clusters} & \multicolumn{1}{c|}{large-clusters} & \multicolumn{1}{l|}{} \\ \hline
				\multicolumn{1}{|c|}{9} & \multicolumn{1}{c|}{2} & \multicolumn{1}{c|}{4} & \multicolumn{1}{c|}{300} \\ \hline
				\multicolumn{4}{l}{} \\ \hline
				\multicolumn{4}{|c|}{\cellcolor{light-gray}\textbf{Konfigurierte Konstanten}} \\ \hline \hline
				\multicolumn{1}{|l|}{} & \multicolumn{1}{c|}{\textbf{insertion}} & \multicolumn{1}{c|}{\textbf{deletion}} & \multicolumn{1}{c|}{\textbf{substitution}} \\ \hline
				\multicolumn{1}{|l|}{\textbf{error-per-base}} & \multicolumn{1}{c|}{$ 2.8 \, \cdotp 10^{-6} $} & \multicolumn{1}{c|}{$ 5.1 \, \cdotp 10^{-6} $} & \multicolumn{1}{c|}{$L_{i} = \frac{1}{3} \; \cdotp \; p_{i}$} \\ \hline
				\multicolumn{1}{|l|}{\textbf{heterozygosity}} & \multicolumn{1}{c|}{0.01} & \multicolumn{1}{c|}{0.01} & \multicolumn{1}{c|}{0.01} \\ \hline
			\end{tabular}
			\caption{Schwellenwerte und Konstanten für den NodeRAD-Run mit dem ddRAGE-Testdatensatz.}
			\label{tbl:config}
		\end{center}
	\end{table}
\end{frame}


%%Folie 39
\section{Analyse an simulierten Daten}
\subsection{BLAST-Analyse: Auffinden der Loci}
\begin{frame}
	\begin{onlyenv}<1-2,4-5>
		\only<1-2,4-5>{\frametitle{BLAST-Analyse: Auffinden der Loci}	}
		\begin{itemize}
			\item Individuum A: 44/50 Loci
			\item Individuum B: 48/50 Loci
			\item Individuum C: 47/50 Loci
		\end{itemize}
		\hspace*{0.4cm}$\Rightarrow$ insgesamt $ 92\% $ der Loci identifiziert
		\vspace*{0.4cm}
		\begin{itemize}
			\visible<2->{
			\item die meisten der gefundenen Loci sind identisch zu den tatsächlich simulierten Loci
			\item die Allele mit geringerem Identity-Wert sind meist zusätzliche Allele, die durch NodeRAD zu dem Locus gefunden wurden}
			\visible<5->{
			\item Individuum A: 62 Allele durch NodeRAD identifiziert, davon stimmen 49 Allele exakt mit den simulierten Allelen aus ddRAGE überein
			}
		\end{itemize}
	\end{onlyenv}
	\begin{onlyenv}<3,6>
		\only<3>{
		\vspace*{0.05cm}
			\begin{figure}[H]
				\begin{center}
					\includegraphics[height=9.0cm]{pictures/A.plot_loci.pdf}
				\end{center}
			\end{figure}}
		\only<6>{
			\begin{figure}[H]
				\begin{center}
					\includegraphics[height=9.0cm]{pictures/A.plot_hist.pdf}
				\end{center}
			\end{figure}}
	\end{onlyenv}
\end{frame}


%%Folie 40
\section{Analyse an simulierten Daten}
\subsection{BLAST-Analyse: Auffinden der Loci}
\begin{frame}
	\frametitle{Loci-Zuordnung durch NodeRAD im Vergleich zum tatsächlichen Genotyp}
	\begin{table}[H]
		\begin{center}
			\begin{tabular}{ccccc}
				\hline
				\multicolumn{2}{|c|}{\cellcolor{light-gray}} & \multicolumn{3}{c|}{\cellcolor{light-gray}\textbf{simulierte Loci $n = 150$}} \\ \cline{3-5} 
				\multicolumn{2}{|c|}{\multirow{-2}{*}{\cellcolor{light-gray}\textbf{Individuum A, B und C}}} & \multicolumn{1}{l|}{\textbf{homozygot}} & \multicolumn{1}{l|}{\textbf{heterozygot}} & \multicolumn{1}{l|}{\textbf{$\sum$}} \\ \hline
				\multicolumn{1}{|c|}{\cellcolor{light-gray}} & \multicolumn{1}{c|}{\textbf{homozygot}} & \multicolumn{1}{c|}{124} & \multicolumn{1}{c|}{0} & \multicolumn{1}{c|}{124} \\ \cline{2-5} 
				\multicolumn{1}{|c|}{\cellcolor{light-gray}} & \multicolumn{1}{c|}{\textbf{heterozygot}} & \multicolumn{1}{c|}{10} & \multicolumn{1}{c|}{5} & \multicolumn{1}{c|}{15} \\ \cline{2-5} 
				\multicolumn{1}{|c|}{\multirow{-3}{*}{\cellcolor{light-gray}\textbf{\begin{tabular}[c]{@{}c@{}}mit NodeRAD\\ identifizierte\\ Loci\end{tabular}}}} & \multicolumn{1}{c|}{\textbf{$\sum$}} & \multicolumn{1}{c|}{134} & \multicolumn{1}{c|}{5} & \multicolumn{1}{c|}{\textbf{139}} \\ \hline
				\multicolumn{5}{l}{}			
			\end{tabular}
		\end{center}
	\end{table}
	\visible<2>{
	\begin{itemize}
		\item Rate \textbf{falsch-homozygoter} Loci: $0\%$
		\item Rate \textbf{falsch-heterozygoter} Loci: $\approx 7.5\%$
		\item \textbf{prädiktiv homozygot} (NodeRAD findet homozygoten Locus):\\ 
		$\Rightarrow$ Wahrscheinlichkeit, dass tatsächlich homozygot: $100\%$
		\item \textbf{prädiktiv heterozygot} (NodeRAD findet heterozygoten Locus):\\ $\Rightarrow$ Wahrscheinlichkeit, dass tatsächlich heterozygot: $ \approx 33.\overline{3}\, \% $
	\end{itemize}
	}
\end{frame}

%%Folie 41
\section{Ausblick}
\subsection{}
\begin{frame}
	\frametitle{Ausblick}
	\begin{itemize}
		\item effizientere Implementierung in Rust
		\vspace*{0.1cm}
		\item  dominierender Schritte (Laufzeit, Arbeitsspeicher) sind die Bestimmung der Allelkombinationen und die über ihre Allele-Fractions ausgeführten Berechnungen, dieser Schritt kann weiter optimiert werden, z.B.:
		\vspace*{0.05cm}
			\begin{itemize}
				\item Funktion(Clustergröße, Anzahl der Kandidatenallele)
				\item greedy Auswahl der Allele: absteigende Sortierung nach Häufigkeit und Knotengrad
				\item nur rechenintensive Cluster (große Cluster oder Cluster mit vielen Kandidatenallelen) optimieren
			\end{itemize}
		\vspace*{0.05cm}
		\item single-end Reads: Heterozygotie bleibt auch bei Mutationen im Bereich der Restriktionsstelle erhalten
		\vspace*{0.1cm}
		\item polyploide Organismen: multiple Sequenzalignments notwendig
		\vspace*{0.1cm}
		\item interindividuelle Vergleiche für Diversitätsanalysen können als zweite Iteration des Workflows adaptiert werden
	\end{itemize}
\end{frame}


%%%Folie 42
%\section{Ausblick}
%\subsection{}
%\begin{frame}
%	\frametitle{}
%	text
%\end{frame}


%Literaturverzeichnis
\section{Bildquellen}
\begin{frame}[allowframebreaks]
	\frametitle{Bildquellen}
	\bibliographystyle{unsrtdin}
	\bibliography{bibliography/RAD-Seq_slices}
%	\addcontentsline{toc}{section}{\bibname}
\end{frame}

%weiteres Bildmaterial 
\section{Bildquellen}
\begin{frame}
	\frametitle{Weiteres Bildmaterial für die Erstellung des Workflowdiagramms}
	\textbf{Diagramm}: Alanis, Cristo J.: Schema of Labs on a class. source: \url{https://texample.net/
	tikz/examples/labs-schema/}.\\ 
	\vspace*{0.3cm}
	\textbf{Abbildung der DNA}: Velickovic, Petar: Deoxyribonucleic acid (DNA). source: \url{https://github.com/
	PetarV-/TikZ/tree/master/DNA}.\\ 
	\vspace*{0.3cm}
	\textbf{Icon für VCF-Datei}: Twitter, Inc., Mark Otto, and the Bootstrap authors: Bootstrap icons -
	receipt. source: \url{https://github.com/twbs/icons/blob/main/icons/receipt.svg}.
\end{frame}

\end{document}